<!DOCTYPE html>
<head>
	<meta charset="utf-8" />
	<meta name="description" content="HTML5 experiments. Stuff without purpose.">
    <meta name="author" content="Daniel Pettersson">
	<title>Uglyhack</title>	
	
	<link href="uglyhack.css" rel="stylesheet" type="text/css"></link>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js" type="text/javascript"></script>
	<script src="resources/RequestAnimationFrame.js" type="text/javascript"></script>

	<script type="text/javascript">
		
		var experiments = [];
		var mousex = null;
		var mousey = null;

		function initialize() {
			var globalScale = window.innerWidth/2000;
			var expwidth = 280*globalScale;
			var expheight = 200*globalScale;

			var bounceFactor = 0.7;
			var friction = 0.9;
			var force = 0.02/globalScale;
			var borderForceWidth = window.innerWidth/15;
			var borderForce = 0.03/globalScale;
			var mouseForce = 0.008/globalScale;
			var expScaleRad = 300*globalScale;
			var expScaleFact = 0.6;


			function Experiment(name, href, logo) {
				this.name = name;
				this.href = href;
				this.logo = logo;
				this.dx = 0;
				this.dy = 0;
				this.exp = null;
				this.noff = null;
				this.scale = 1.0;
				this.x = Math.random() * (window.innerWidth - expwidth);
				this.y = Math.random() * (window.innerHeight - expheight);
			};

			Experiment.prototype.init = function() {
				this.exp = $('<div>').addClass('experiment').css({
					'z-index': 100,
					'width': expwidth + 'px',
					'height': expheight + 'px'
				});
				var a = $('<a>').attr('href', this.href);
				var fadeable = $('<div>').addClass('fadeable').css({
					'background-image': "url('" + this.logo + "')",
					'background-size': expwidth + 'px ' + expheight + 'px'
				});
				var inner = $('<div>').addClass('inner');
				var title = $('<h3>').css({
					'font-size': expwidth/10 + 'pt'
				}).text(this.name);

				inner.append(title);
				fadeable.append(inner);
				a.append(fadeable);
				this.exp.append(a);
				
				$('.content').append(this.exp);

				return this;
			};

			Experiment.prototype.calcForces = function() {
				var xx = 0;
				var yy = 0;
				var ll = experiments.length;
				var other;
				var fx = 0;
				var fy = 0;
				var f = 0;
				var ddx = 0;
				var ddy = 0;
				var ww = expwidth*this.scale;
				var hh = expheight*this.scale;
				var mass = 1;
				
				this.dx *= friction;
				this.dy *= friction;

				for(var i = 0; i < ll; i++) {
					other = experiments[i];
					if(other !== this) {
						ddy = this.y - other.y;
						ddx = this.x - other.x;
						f = Math.sqrt(Math.pow(ddx, 2) + Math.pow(ddy, 2));
						f = f*f*force;
						mass = Math.pow(other.scale, 5);
						fx += (ddx/f)*mass;
						fy += (ddy/f)*mass;
					}
				}

				if(mousex && mousey) {
					ddy = this.y - (mousey - hh/this.scale/2);
					ddx = this.x - (mousex - ww/this.scale/2);
					if(Math.abs(ddx) > 1 || Math.abs(ddy) > 1) {
						f = Math.sqrt(Math.pow(ddx, 2) + Math.pow(ddy, 2));
						if(f < 30) {
							f = 15 + f/2;
						}
						f = f*f*mouseForce;
						fx -= ddx/f;
						fy -= ddy/f;

						if(f < expScaleRad) {
							this.scale = 1 + ((expScaleRad - f)/expScaleRad)*expScaleFact;
						} else if(this.scale > 1.0) {
							this.scale /= 1.05;
						}
						
					}
				}

				if(this.y < borderForceWidth) {
					fy += (borderForceWidth - this.y)*borderForce;
				}
				if(this.y > window.innerHeight-hh - borderForceWidth) {
					fy -= (borderForceWidth - (window.innerHeight-hh-this.y))*borderForce;
				}

				if(this.x < borderForceWidth) {
					fx += (borderForceWidth - this.x)*borderForce;
				}
				if(this.x > window.innerWidth-ww - borderForceWidth) {
					fx -= (borderForceWidth - (window.innerWidth-ww-this.x))*borderForce;
				}

				if(this.y < 0) {
					this.y = 0;
					this.dx = this.dx*bounceFactor;
					this.dy = -this.dy*bounceFactor;
				}
				if(this.y > window.innerHeight-hh) {
					this.y = window.innerHeight-hh;
					this.dx = this.dx*bounceFactor;
					this.dy = -this.dy*bounceFactor;
				}

				if(this.x < 0) {
					this.x = 0;
					this.dx = -this.dx*bounceFactor;
					this.dy = this.dy*bounceFactor;
				}
				if(this.x > window.innerWidth-ww) {
					this.x = window.innerWidth-ww;
					this.dx = -this.dx*bounceFactor;
					this.dy = this.dy*bounceFactor;
				}

				this.dx += fx;
				this.dy += fy;

				this.y += this.dy;
				this.x += this.dx;
			};

			Experiment.prototype.move = function() {
				var transStr = 'translate(' + this.x + 'px, ' + this.y +'px) scale(' + this.scale + ')';
				this.exp.css({
					'z-index': Math.floor(this.scale*100),
					'-webkit-transform': transStr,
					'-moz-transform': transStr,
					'transform': transStr,
					'-ms-transform': transStr
				});
			};

			experiments.push( new Experiment('Box Jitsu', 'http://box.jit.su', 'nodebox/logo.jpg').init() );
			experiments.push( new Experiment('SprichSprach', 'https://uglyhack.appspot.com/sprichensprachen/', 'sprichensprachen/logo.jpg').init() );
			experiments.push( new Experiment('Boingy', 'boingy/', 'boingy/logo.jpg').init() );
			experiments.push( new Experiment('WebAudioToy', 'webaudiotoy/', 'webaudiotoy/logo.jpg').init() );
			experiments.push( new Experiment('JFokus', 'jfokus/', 'jfokus/logo.jpg').init() );
			experiments.push( new Experiment('Systemet', 'systemet/', 'systemet/logo.jpg').init() );
			experiments.push( new Experiment('Hypnotron', 'hypnotron/', 'hypnotron/logo.jpg').init() );
			experiments.push( new Experiment('VideoFx', 'videofx/', 'videofx/logo.jpg').init() );
			experiments.push( new Experiment('CubeVideo', 'cubevideo/', 'cubevideo/logo.jpg').init() );
			experiments.push( new Experiment('Twittergraph', 'twittergraph/', 'twittergraph/logo.jpg').init() );
			experiments.push( new Experiment('Artistgraph', 'artistgraph/', 'artistgraph/logo.jpg').init() );
			experiments.push( new Experiment('3d Cube', '3d/', '3d/logo.jpg').init() );
			experiments.push( new Experiment('Chaosdraw', 'chaosdraw/', 'chaosdraw/logo.jpg').init() );
			experiments.push( new Experiment('Shake', 'shake/', 'shake/logo.jpg').init() );

			$('h1').css({
				'font-size': 100*globalScale + 'px'
			});
			$('h2').css({
				'font-size': 40*globalScale + 'px'
			});
			$('#html5img').css({
				width: 63*globalScale + 'px',
				height: 64*globalScale + 'px'
			});
		}

		$(window).load(function () {
			$(".content").mousemove(function(event) {
			  	mousex = event.pageX;
			  	mousey = event.pageY;
			});

			initialize();

			var animate = function() {
				for(var i = 0; i < experiments.length; i++) {
					experiments[i].calcForces();
				}
				for(var i = 0; i < experiments.length; i++) {
					experiments[i].move();
				}
				requestAnimationFrame( animate );
			}
			
			animate();

			window.addEventListener('resize', doResize, false);
			window.addEventListener('orientationchange', doResize, false);

			function doResize() {
				mousex = null;
				mousey = null;
				experiments = [];
				$('.experiment').remove();
				initialize();
			}

			canvas.addEventListener("touchstart", function(e) {
				mousex = e.changedTouches[0].clientX;
				mousey = e.changedTouches[0].clientY;
			}, false);

			canvas.addEventListener("touchend", function(e) {
				mousex = null;
				mousey = null;
			}, false);

			canvas.addEventListener("touchmove", function(e) {
				mousex = e.changedTouches[0].clientX;
				mousey = e.changedTouches[0].clientY;
			}, false);
		});
	</script>
</head>
<body>
	<div class="content">
		<section>
			<div class="headersquare">
			<h1><img src="html5.png" id="html5img" />Uglyhack</h1>
			<h2 id="subtitle">"Stuff without purpose"</h2>
			</div>
			

		</section>
		<footer>
			Made by Daniel Pettersson. Code at <a href="http://code.google.com/p/uglyhack/">Google Code</a>
		</footer>

	</div>
</body>