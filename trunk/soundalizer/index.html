<!DOCTYPE html> 
<html>
	<head> 
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		
		<title>Soundalizer</title> 

		<script src="js/class.js" type="text/javascript"></script>
		<script src="js/baseNode.js" type="text/javascript"></script>
		<script src="js/biquadFilterNode.js" type="text/javascript"></script>
		<script src="js/convolverNode.js" type="text/javascript"></script>
		<script src="js/delayNode.js" type="text/javascript"></script>
		<script src="js/destinationNode.js" type="text/javascript"></script>
		<script src="js/dynamicsCompressorNode.js" type="text/javascript"></script>
		<script src="js/gainNode.js" type="text/javascript"></script>
		<script src="js/scriptNode.js" type="text/javascript"></script>
		<script src="js/sourceNode.js" type="text/javascript"></script>

		<script type="text/javascript">
			/* 
			navigator.webkitGetUserMedia('audio', function (stream) {
	    		var objectUrl = window.webkitURL.createObjectURL(stream);
		    	var audioTag = document.getElementById('audioTag');
		    	audioTag.src = objectUrl;
		    	var sourceNode = context.createMediaElementSource(audioTag);
		   	});
	    	*/
    
    		var nodes = new Array();
			var context = null;
	
    		function doConnect() {
    			var from = document.getElementById('fromNode').value;
    			var to = document.getElementById('toNode').value;
    			nodes[from].connectTo(nodes[to]); 
    		}
    		
    		function doDisconnect() {
    			var from = document.getElementById('fromNode').value;
    			var to = document.getElementById('toNode').value;
    			nodes[from].disconnectFrom(nodes[to]); 
    		}
    		
    		function doCreate() {
    			var createVal = document.getElementById('createSelect').value;
    			var node = null;
    			switch(createVal) {
	    			case "source":
	    				node = new SourceNode(nodes.length);
						break;
	    			case "biquadFilter":
	    				node = new BiquadFilterNode(nodes.length);
						break;
	    			case "gain":
	    				node = new GainNode(nodes.length);
						break;
	    			case "convolver":
	    				node = new ConvolverNode(nodes.length);
						break;
	    			case "delay":
	    				node = new DelayNode(nodes.length);
						break;
	    			case "dynamicscompressor":
	    				node = new DynamicsCompressorNode(nodes.length);
						break;
	    			case "script":
	    				node = new ScriptNode(nodes.length);
						break;
						
    			}
    			if(node != null) {
    				nodes.push(node);
    			}
    			var from = document.getElementById('fromNode');
    			from.innerHTML = "";
    			for(var i in nodes) {
    				if(!(nodes[i] instanceof DestinationNode)) {
	    				var optionEl = document.createElement('option');
						optionEl.innerHTML = nodes[i].name;
						optionEl.setAttribute('value', nodes[i].idx);
						from.appendChild(optionEl);
    				}
    			}
    			
    			var to = document.getElementById('toNode');
    			to.innerHTML = "";
    			for(var i in nodes) {
    				if(!(nodes[i] instanceof SourceNode)) {
	    				var optionEl = document.createElement('option');
						optionEl.innerHTML = nodes[i].name;
						optionEl.setAttribute('value', nodes[i].idx);
						to.appendChild(optionEl);
    				}
    			}
    			printConnections();
    		}
			
			function printConnections() {
				var connDiv = document.getElementById('connections');
				connDiv.innerHTML = "";
				for(var i in nodes) {
					if(!(nodes[i] instanceof DestinationNode)) {
						connDiv.innerHTML += nodes[i].toString();	
						connDiv.innerHTML += '<br/>'
					}
				}
			}
			
			function init() {
				context = new (window.AudioContext || window.webkitAudioContext)();
				nodes[0] = new DestinationNode(0);
			} 

	    </script>

		<style> 
			body {
				overflow: hidden;
				height: 100%;
			}

			div.fullscreen {
			    position: fixed;
			    top:0;
			    left:0;
			    
			    width:100%;
			    height:100%;
			}
			
			div.node {
				width:150px;
				height:150px;
				background: #999999;
				float: right;
				margin: 5px;
			}
			
			div.nodebig {
				width:300px;
				height:250px;
				background: #999999;
				float: right;
				margin: 5px;
			}
		</style>

	</head>
	
	<body onload="setTimeout('init()', 1000)">
		<div style="float: left;">
			<div>
				<select id="createSelect">
					<option>source</option>
					<option>biquadFilter</option>
					<option>gain</option>
					<option>convolver</option>
					<option>delay</option>
					<option>dynamicscompressor</option>
					<option>script</option>
				</select>
				<input type="button" value="Create" onclick="doCreate()"></input>
			</div>
			<select id="fromNode">
			</select>
			to
			<select id="toNode">
				<option value="0">destination</option>
			</select>
			<input type="button" value="Connect" onclick="doConnect()"></input>
			<input type="button" value="Disconnect" onclick="doDisconnect()"></input>
			<div id="connections"></div>
		</div>
	</body>
</html>
