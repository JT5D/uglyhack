(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(g){var f=this.prototype;a=true;var e=new this();a=false;for(var d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,j){return function(){var m=this._super;this._super=f[h];var k=j.apply(this,arguments);this._super=m;return k}})(d,g[d]):g[d]}function c(){if(!a&&this.init){this.init.apply(this,arguments)}}c.prototype=e;c.prototype.constructor=c;c.extend=arguments.callee;return c}})();if(typeof(waapisimLogEnable)==="undefined"){var waapisimLogEnable=0}if(typeof(Float32Array)==="undefined"){Float32Array=function(c){if(c instanceof Array){return c}var b=new Array(c);b.subarray=function(a,d){return this.slice(a,d)};b.set=function(a,e){for(var d=0;d<a.length;++d){b[e+d]=a[d]}};return b}}if(typeof(Uint8Array)==="undefined"){Uint8Array=function(c){if(c instanceof Array){return c}var b=new Array(c);b.subarray=function(a,d){return this.slice(a,d)};b.set=function(a,e){for(var d=0;d<a.length;++d){b[e+d]=a[d]}};return b}}if(typeof(waapisimLogEnable)!=="undefined"&&waapisimLogEnable){waapisimDebug=console.log}else{waapisimDebug=function(){}}if(typeof(webkitAudioContext)!=="undefined"){if(typeof(webkitAudioContext.prototype.createGain)==="undefined"){webkitAudioContext.prototype.createScriptProcessor=webkitAudioContext.prototype.createJavaScriptNode;webkitAudioContext.prototype.createGain=(function(){var a=webkitAudioContext.prototype.createGainNode.call(this);a._gain=a.gain;a.gain=a._gain;a.gain.setTargetAtTime=a._gain.setTargetValueAtTime;return a});webkitAudioContext.prototype.createDelay=(function(){var a=webkitAudioContext.prototype.createDelayNode.call(this);a._delayTime=a.delayTime;a.delayTime=a._delayTime;a.delayTime.setTargetAtTime=a._delayTime.setTargetValueAtTime;return a});webkitAudioContext.prototype._createOscillator=webkitAudioContext.prototype.createOscillator;webkitAudioContext.prototype.createOscillator=(function(){var a=webkitAudioContext.prototype._createOscillator.call(this);a._frequency=a.frequency;a.frequency=a._frequency;a.frequency.setTargetAtTime=a._frequency.setTargetValueAtTime;a._detune=a.detune;a.detune=a._detune;a.detune.setTargetAtTime=a._detune.setTargetValueAtTime;a.start=a.noteOn;a.stop=a.noteOff;return a});webkitAudioContext.prototype._createBufferSource=webkitAudioContext.prototype.createBufferSource;webkitAudioContext.prototype.createBufferSource=(function(){var a=webkitAudioContext.prototype._createBufferSource.call(this);a._playbackRate=a.playbackRate;a.playbackRate=a._playbackRate;a.playbackRate.setTargetAtTime=a._playbackRate.setTargetValueAtTime;a.start=function(b,d,c){if(d===undefined){a.noteOn(b)}else{a.noteGrainOn(b,d,c)}};a.stop=a.noteOff;return a});webkitAudioContext.prototype._createBiquadFilter=webkitAudioContext.prototype.createBiquadFilter;webkitAudioContext.prototype.createBiquadFilter=(function(){var a=webkitAudioContext.prototype._createBiquadFilter.call(this);a._frequency=a.frequency;a.frequency=a._frequency;a.frequency.setTargetAtTime=a._frequency.setTargetValueAtTime;a._Q=a.Q;a.Q=a._Q;a.Q.setTargetAtTime=a._Q.setTargetValueAtTime;a._gain=a.gain;a.gain=a._gain;a.gain.setTargetAtTime=a._gain.setTargetValueAtTime;return a});webkitAudioContext.prototype._createDynamicsCompressor=webkitAudioContext.prototype.createDynamicsCompressor;webkitAudioContext.prototype.createDynamicsCompressor=(function(){var a=webkitAudioContext.prototype._createDynamicsCompressor.call(this);a._threshold=a.threshold;a.threshold=a._threshold;a.threshold.setTargetAtTime=a._threshold.setTargetValueAtTime;a._knee=a.knee;a.knee=a._knee;a.knee.setTargetAtTime=a._knee.setTargetValueAtTime;a._ratio=a.ratio;a.ratio=a._ratio;a.ratio.setTargetAtTime=a._ratio.setTargetValueAtTime;a._attack=a.attack;a.attack=a._attack;a.attack.setTargetAtTime=a._attack.setTargetValueAtTime;return a})}}if(typeof(webkitAudioContext)==="undefined"&&typeof(AudioContext)==="undefined"){waapisimSampleRate=44100;waapisimAudioIf=0;waapisimBufSize=1024;waapisimFlashBufSize=1024*3;if(typeof(Audio)!=="undefined"){waapisimAudio=new Audio();if(typeof(waapisimAudio.mozSetup)!=="undefined"){waapisimAudioIf=1}}if(waapisimAudioIf===0){waapisimOutBufSize=waapisimFlashBufSize;waapisimOutBuf=new Array(waapisimOutBufSize*2)}else{waapisimOutBufSize=waapisimBufSize;waapisimOutBuf=new Float32Array(waapisimOutBufSize*2);waapisimAudio.mozSetup(2,waapisimSampleRate)}for(var l=waapisimOutBuf.length,i=0;i<l;++i){waapisimOutBuf[i]=0}waapisimWrittenpos=0;waapisimNodeId=0;waapisimContexts=[];waapisimAudioBuffer=function(m,s,u){var r,q;if(typeof(m)=="number"){this.sampleRate=u;this.length=s;this.duration=s/this.sampleRate;this.numberOfChannels=m;this.buf=[];for(r=0;r<2;++r){this.buf[r]=new Float32Array(s);for(q=0;q<s;++q){this.buf[r][q]=0}}}else{var a;this.sampleRate=44100;this.buf=[];this.buf[0]=new Float32Array(0);this.buf[1]=new Float32Array(0);this.Get4BStr=function(j,w){return String.fromCharCode(j[w],j[w+1],j[w+2],j[w+3])};this.GetDw=function(j,w){return j[w]+(j[w+1]<<8)+(j[w+2]<<16)+(j[w+3]<<24)};this.GetWd=function(j,w){return j[w]+(j[w+1]<<8)};a=new Uint8Array(m);var b=s;var o=this.Get4BStr(a,0);if(o=="RIFF"){var g=this.GetDw(a,4)+8;var h=this.Get4BStr(a,8);var t=0;var p=1;var f=16;if(h=="WAVE"){var n=12;while(n<g){var k=this.Get4BStr(a,n);var e=this.GetDw(a,n+4);if(k=="fmt "){t=this.GetWd(a,n+8);p=this.GetWd(a,n+10);this.sampleRate=this.GetDw(a,n+12);f=this.GetWd(a,n+22)}if(k=="data"){this.length=(e/p/(f/8))|0;this.buf[0]=new Float32Array(this.length);this.buf[1]=new Float32Array(this.length);this.numberOfChannels=p;this.duration=this.length/this.sampleRate;var d,c;for(r=0,q=0;r<this.length;++r){if(f==16){if(p==2){d=a[n+q+8]+(a[n+q+9]<<8);c=a[n+q+10]+(a[n+q+11]<<8);if(d>=32768){d=d-65536}if(c>=32768){c=c-65536}if(b===true){d=c=(d+c)*0.5}this.buf[0][r]=d/32768;this.buf[1][r]=c/32768;q+=4}else{v=a[n+q+8]+(a[n+q+9]<<8);if(v>=32768){v=v-65536}this.buf[0][r]=this.buf[1][r]=v/32768;q+=2}}else{if(p==2){d=a[n+q+8]/128-1;c=a[n+q+9]/128-1;if(b===true){d=c=(d+c)*0.5}this.buf[0][r]=d;this.buf[1][r]=c;q+=2}else{this.buf[0][r]=this.buf[1][r]=a[n+q+8]/128-1;q++}}}}n+=(e+8)}}}}this.getChannelData=function(j){return this.buf[j]}};waapisimDummybuf=new waapisimAudioBuffer(2,waapisimBufSize,waapisimSampleRate);waapisimSetupOutBuf=function(f){var a=waapisimContexts.length;var e,h,g,c,d;for(e=(f+waapisimBufSize)*2,h=f*2;h<e;h+=2){waapisimOutBuf[h]=waapisimOutBuf[h+1]=0}for(c=0;c<a;++c){var k=waapisimContexts[c];for(;;){for(e=k._Nodes.length,h=0;h<e;++h){d=k._Nodes[h];if(d.playbackState==3){d.disconnect();k._UnregisterNode(d);break}}if(h==e){break}}for(e=k._Nodes.length,h=0;h<e;++h){k._Nodes[h]._Process()}d=k.destination;if(d._nodein[0].from.length>0){var b=d._nodein[0].inbuf.buf;for(h=0;h<waapisimBufSize;++h){waapisimOutBuf[(h+f)*2]+=b[0][h];waapisimOutBuf[(h+f)*2+1]+=b[1][h]}}d._nodein[0].NodeClear()}};waapisimUpdateCurrentTime=function(b){for(var a=waapisimContexts.length;a--;){waapisimContexts[a].currentTime=b}};waapisimInterval=function(){var d=waapisimAudio.mozCurrentSampleOffset();var b=waapisimWrittenpos-d;var c,a;waapisimUpdateCurrentTime(d/(waapisimSampleRate*2));if(b<16384){waapisimSetupOutBuf(0);waapisimWrittenpos+=waapisimAudio.mozWriteAudio(waapisimOutBuf)}};waapisimGetSwfPath=function(){var c=document.getElementsByTagName("SCRIPT");if(c&&c.length>0){for(var a in c){if(c[a].src&&c[a].src.match(/waapisim\.js$/)){var b=c[a].src;return b.substring(0,b.length-2)+"swf"}}}return""};waapisimAddFlashObj=function(){var b=document.createElement("DIV");b.setAttribute("id","WAAPISIMFLASHOBJ");b.setAttribute("style","background:#ff00ff;positoin:static;");var a=document.getElementsByTagName("BODY");a[0].appendChild(b);document.getElementById("WAAPISIMFLASHOBJ").innerHTML="<div style='position:fixed;right:0px;bottom:0px'> <object id='waapisim_swf' CLASSID='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000' CODEBASE='http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=4,0,0,0' width=150 height=20><param name=movie value='"+waapisimSwfPath+"'><PARAM NAME=bgcolor VALUE=#FFFFFF><PARAM NAME=LOOP VALUE=false><PARAM NAME=quality VALUE=high><param name='allowScriptAccess' value='always'><embed src='"+waapisimSwfPath+"' width=150 height=20 bgcolor=#FFFFFF loop=false quality=high pluginspage='http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash' type='application/x-shockwave-flash' allowScriptAccess='always'></embed></object></div>"};waapisimFlashOffset=function(a){waapisimUpdateCurrentTime(a/1000)};waapisimFlashGetData=function(){var c="";var a;for(a=waapisimOutBufSize/waapisimBufSize,i=0;i<a;++i){waapisimSetupOutBuf(waapisimBufSize*i)}waapisimWrittenpos+=waapisimOutBufSize*2;for(a=waapisimOutBufSize*2,i=0;i<a;++i){var b=((waapisimOutBuf[i]+1)*32768)|0;if(isNaN(b)){b=32768}if(b>65525){b=65525}if(b<1){b=1}c+=String.fromCharCode(b)}return c};switch(waapisimAudioIf){case 0:waapisimSwfPath=waapisimGetSwfPath();window.addEventListener("load",waapisimAddFlashObj,false);break;case 1:setInterval(waapisimInterval,10);break}AudioContext=webkitAudioContext=function(){waapisimContexts.push(this);this._Nodes=[];this.destination=new waapisimAudioDestinationNode(this);this.sampleRate=44100;this.currentTime=0;this.activeSourceCount=0;this.listener=new waapisimAudioListener();this.createBuffer=function(c,a,b){return new waapisimAudioBuffer(c,a,b)};this.createBufferSource=function(){return new waapisimAudioBufferSource(this)};this.createScriptProcessor=this.createJavaScriptNode=function(b,a,c){return new waapisimScriptProcessor(this,b,a,c)};this.createBiquadFilter=function(){return new waapisimBiquadFilter(this)};this.createGain=this.createGainNode=function(){return new waapisimGain(this)};this.createDelay=this.createDelayNode=function(){return new waapisimDelay(this)};this.createOscillator=function(){return new waapisimOscillator(this)};this.createAnalyser=function(){return new waapisimAnalyser(this)};this.createConvolver=function(){return new waapisimConvolver(this)};this.createDynamicsCompressor=function(){return new waapisimDynamicsCompressor(this)};this.createPanner=function(){return new waapisimPanner(this)};this.createChannelSplitter=function(a){return new waapisimChannelSplitter(this,a)};this.createChannelMerger=function(a){return new waapisimChannelMerger(this,a)};this.createWaveShaper=function(){return new waapisimWaveShaper(this)};this.decodeAudioData=function(d,a,b){var c=new waapisimAudioBuffer(d,false);a(c)};this.createWaveTable=function(b,a){return new waapisimWaveTable(b,a)};this._RegisterNode=function(b){for(var a=this._Nodes.length;a--;){if(this._Nodes[a]===b){return false}}this._Nodes.push(b);return true};this._UnregisterNode=function(b){for(var a=this._Nodes.length;a--;){if(this._Nodes[a]==b){this._Nodes.splice(a,1)}}}};waapisimAudioListener=function(){this.px=0;this.py=0;this.pz=0;this.ox=0;this.oy=0;this.oz=-1;this.ux=0;this.uy=1;this.uz=0;this.dopplerFactor=1;this.speedOfSound=343.3;this.setPosition=function(a,c,b){this.px=a;this.py=c;this.pz=b};this.setOrientation=function(a,f,e,d,c,b){this.ox=a;this.oy=f;this.oz=e;this.ux=d;this.uy=c;this.uz=b};this.setVelocity=function(a,c,b){}};waapisimWaveTable=function(w,b){var d=4096;var g=new Array(d);var t=new Array(d);this.buf=new Float32Array(d);var e,q,p,o,h;var r,a,f,s;for(p=0;p<d;++p){g[p]=t[p]=0}p=o=0;do{g[p]=w[o];t[p]=-b[o];for(var h=d>>1;h>(p^=h);h>>=1){}}while(++o<w.length);var c=2*Math.PI;for(q=1;(e=q<<1)<=d;q=e){c*=0.5;for(p=0;p<q;p++){r=Math.cos(c*p);a=Math.sin(c*p);for(o=p;o<d;o+=e){h=o+q;f=r*g[h]-a*t[h];s=r*t[h]+a*g[h];g[h]=g[o]-f;t[h]=t[o]-s;g[o]+=f;t[o]+=s}}}var u=0;for(p=0;p<d;++p){var x=Math.abs(g[p]);if(x>u){u=x}}if(u==0){for(p=0;p<d;++p){this.buf[p]=0}}else{for(p=0;p<d;++p){this.buf[p]=g[p]/u}}};waapisimAudioNode=function(b,c,d){this.numberOfInputs=c;this.numberOfOutputs=d;this._nodeId=waapisimNodeId;++waapisimNodeId;this._targettype=1;this.context=null;this.bufsize=b;this._nodein=[];this._nodeout=[];var a;for(a=0;a<c;++a){this._nodein[a]=new waapisimAudioNodeIn(this,b)}for(a=0;a<d;++a){this._nodeout[a]=new waapisimAudioNodeOut(this,b)}this.connect=function(g,f,e){if(typeof(f)==="undefined"){f=0}if(typeof(e)==="undefined"){e=0}if(g._targettype!==0){this._nodeout[f].connect(g._nodein[e])}else{this._nodeout[f].connect(g)}};this.disconnect=function(e){if(typeof(e)==="undefined"){e=0}this._nodeout[e].disconnect()}};waapisimAudioNodeIn=function(b,a){this.node=b;this.from=[];this.inbuf=new waapisimAudioBuffer(2,a,waapisimSampleRate);this.NodeClear=function(){for(var c=0;c<waapisimBufSize;++c){this.inbuf.buf[0][c]=this.inbuf.buf[1][c]=0}}};waapisimAudioNodeOut=function(b,a){this.node=b;this.to=[];this.connect=function(e){waapisimDebug("connect "+this.node._nodetype+this.node._nodeId+"=>"+e.node._nodetype+e.node._nodeId);if(e.from.indexOf(this)!=-1){return}e.from.push(this);if(this.to.indexOf(e)==-1){this.to.push(e)}if(e.node._targettype!==0){if(this.node.context._RegisterNode(e.node)){for(var c=0;c<e.node._nodeout.length;++c){for(var d=0;d<e.node._nodeout[c].to.length;++d){e.node._nodeout[c].connect(e.node._nodeout[c].to[d])}}}}};this.disconnectTemp=function(){var m,h,g,f,d,r,o,p,e,q;waapisimDebug("disconnect "+this.node._nodetype+this.node._nodeId);var c=this.node.context._Nodes;for(f=c.length,m=0;m<f;++m){for(p=c[m]._nodein.length,r=0;r<p;++r){h=c[m]._nodein[r].from.indexOf(this);if(h>=0){waapisimDebug("  :"+this.node._nodeId+"=>"+c[m]._nodeId);c[m]._nodein[r].from.splice(h,1)}}}for(m=0;m<c.length;++m){e=c[m];if(e._targettype==1){d=0;for(r=0;r<e._nodein.length;++r){d+=e._nodein[r].from.length}if(d===0){this.node.context._UnregisterNode(e);for(r=0;r<e._nodeout.length;++r){e._nodeout[r].disconnectTemp()}break}}}};this.disconnect=function(){this.disconnectTemp();this.to.length=0};this.NodeEmit=function(c,h,g){for(var d=this.to.length,f=0;f<d;++f){var e=this.to[f].inbuf.buf;e[0][c]+=h;e[1][c]+=g}};this.NodeEmitBuf=function(){for(var c=this.to.length,g=0;g<c;++g){var f=this.to[g].inbuf.buf[0];var e=this.to[g].inbuf.buf[1];for(var d=0;d<waapisimBufSize;++d){f[d]+=this.outbuf.buf[0][d];e[d]+=this.outbuf.buf[1][d]}}};this.outbuf=new waapisimAudioBuffer(2,a,waapisimSampleRate)};waapisimAudioProcessingEvent=function(){};waapisimAudioDestinationNode=function(a){waapisimAudioNode.call(this,waapisimBufSize,1,0);this._nodetype="Destination";waapisimDebug("create "+this._nodetype+this._nodeId);this._targettype=2;this.context=a;this.playbackState=0;this.maxNumberOfChannels=2;this.numberOfChannels=2;this._Process=function(){};a._Nodes.push(this)};waapisimAudioBufferSource=function(a){waapisimAudioNode.call(this,waapisimBufSize,0,1);this._nodetype="BufSrc";waapisimDebug("create "+this._nodetype+this._nodeId);this._targettype=3;this.context=a;this.playbackState=0;this.buffer=null;this.playbackRate=new waapisimAudioParam(a,this,0,10,1);this.loop=false;this.loopStart=0;this.loopEnd=0;this._bufferindex=0;this._whenstart=0;this._whenstop=Number.MAX_VALUE;this._endindex=0;this._actualLoopStart=0;this._actualLoopEnd=0;this.start=this.noteOn=this.noteGrainOn=function(b,d,c){this.playbackState=1;this._whenstart=b;if(d>0){this._bufferindex=d*waapisimSampleRate}this._endindex=this.buffer.length;if(c>0){this._endindex=Math.min(this.buffer.length,(c+d)*waapisimSampleRate)}if(this.loop){if((this.loopStart||this.loopEnd)&&this.loopStart>=0&&this.loopEnd>0&&this.loopStart<this.loopEnd){this._actualLoopStart=this.loopStart;this._actualLoopEnd=Math.min(this.loopEnd,this.buffer.length)}else{this._actualLoopStart=0;this._actualLoopEnd=this.buffer.length}}this.context._RegisterNode(this)};this.stop=this.noteOff=function(b){this._whenstop=b};this._Process=function(){this.playbackRate._Process();if(this.buffer!==null&&this._bufferindex>=this._endindex){if(this.playbackState==2){--this.context.activeSourceCount}this.playbackState=3}if(this.playbackState==1&&this.context.currentTime>=this._whenstart){this.playbackState=2;++this.context.activeSourceCount}if(this.playbackState==2&&this.context.currentTime>=this._whenstop){this.playbackState=3;--this.context.activeSourceCount}if(this.playbackState!=2){return}var e=this.buffer.getChannelData(0);var c=this.buffer.getChannelData(1);var f=44100/this.buffer.sampleRate;if(this._nodeout[0].to.length>0){for(var d=0;d<waapisimBufSize;++d){if(this._bufferindex<this._endindex){var b=this._bufferindex|0;this._nodeout[0].outbuf.buf[0][d]=e[b];this._nodeout[0].outbuf.buf[1][d]=c[b]}this._bufferindex+=f*this.playbackRate.Get(d);if(this.loop){if(this._bufferindex>=this._actualLoopEnd){this._bufferindex=this._actualLoopStart}}}this._nodeout[0].NodeEmitBuf();this.playbackRate.Clear(true)}}};waapisimAudioBufferSource.UNSCHEDULED_STATE=waapisimAudioBufferSource.prototype.UNSCHEDULED_STATE=0;waapisimAudioBufferSource.SCHEDULED_STATE=waapisimAudioBufferSource.prototype.SCHEDULED_STATE=1;waapisimAudioBufferSource.PLAYING_STATE=waapisimAudioBufferSource.prototype.PLAYING_STATE=2;waapisimAudioBufferSource.FINISHED_STATE=waapisimAudioBufferSource.prototype.FINISHED_STATE=3;waapisimScriptProcessor=function(a,c,b,d){waapisimAudioNode.call(this,waapisimBufSize,1,1);this._nodetype="ScrProc";waapisimDebug("create "+this._nodetype+this._nodeId);this._targettype=2;this.context=a;this.playbackState=0;if(typeof(b)==="undefined"){b=2}if(typeof(d)==="undefined"){d=2}this.bufferSize=c;this._scrinbuf=new waapisimAudioBuffer(b,c,waapisimSampleRate);this._scroutbuf=new waapisimAudioBuffer(d,c,waapisimSampleRate);this._index=c;this.onaudioprocess=null;this._Process=function(){var g=this._nodein[0].inbuf;if(g===null){g=waapisimDummybuf}for(var e=0;e<waapisimBufSize;++e){if(this._index>=this.bufferSize){if(this.onaudioprocess){var f=new waapisimAudioProcessingEvent();f.node=this;f.inputBuffer=this._scrinbuf;f.outputBuffer=this._scroutbuf;this.onaudioprocess(f)}this._index=0}this._scrinbuf.buf[0][this._index]=g.buf[0][e];if(this._scrinbuf.numberOfChannels>=2){this._scrinbuf.buf[1][this._index]=g.buf[1][e]}if(this._scroutbuf.numberOfChannels>=2){this._nodeout[0].NodeEmit(e,this._scroutbuf.buf[0][this._index],this._scroutbuf.buf[1][this._index])}else{this._nodeout[0].NodeEmit(e,this._scroutbuf.buf[0][this._index],this._scroutbuf.buf[0][this._index])}this._index++}this._nodein[0].NodeClear()};a._RegisterNode(this)};waapisimBiquadFilter=function(a){waapisimAudioNode.call(this,waapisimBufSize,1,1);this._nodetype="Filter";waapisimDebug("create "+this._nodetype+this._nodeId);this.context=a;this.playbackState=0;this.type=0;this.frequency=new waapisimAudioParam(a,this,10,24000,350);this.detune=new waapisimAudioParam(a,this,-1200,1200,0);this.Q=new waapisimAudioParam(a,this,0.0001,1000,1);this.gain=new waapisimAudioParam(a,this,-40,40,0);this._a1=this._a2=0;this._b0=this._b1=this._b2=0;this._x1l=this._x1r=this._x2l=this._x2r=0;this._y1l=this._y1r=this._y2l=this._y2r=0;this._nodein[0].NodeClear();this._Setup=function(b){var j=b.frequency.Get(0)*Math.pow(2,b.detune.Get(0)/1200);var h=Math.max(0.001,b.Q.Get(0));var m,k,d;var c=2*Math.PI*j/b.context.sampleRate;var e=Math.cos(c);switch(b.type){case"lowpass":case 0:h=Math.pow(10,h/20);m=Math.sin(c)/(2*h);k=1/(1+m);b._a1=-2*e*k;b._a2=(1-m)*k;b._b0=b._b2=(1-e)/2*k;b._b1=(1-e)*k;break;case"highpass":case 1:h=Math.pow(10,h/20);m=Math.sin(c)/(2*h);k=1/(1+m);b._a1=-2*e*k;b._a2=(1-m)*k;b._b0=b._b2=(1+e)/2*k;b._b1=-(1+e)*k;break;case"bandpass":case 2:m=Math.sin(c)/(2*h);k=1/(1+m);b._a1=-2*e*k;b._a2=(1-m)*k;b._b0=m;b._b1=0;b._b2=-m;break;case"lowshelf":case 3:m=Math.sin(c)/2*Math.sqrt(2);d=Math.pow(10,b.gain.Get(0)/40);k=1/((d+1)+(d-1)*e+2*Math.sqrt(d)*m);b._a1=-2*((d-1)+(d+1)*e)*k;b._a2=((d+1)+(d-1)*e-2*Math.sqrt(d)*m)*k;b._b0=d*((d+1)-(d-1)*e+2*Math.sqrt(d)*m)*k;b._b1=2*d*((d-1)-(d+1)*e)*k;b._b2=d*((d+1)-(d-1)*e-2*Math.sqrt(d)*m)*k;break;case"highshelf":case 4:m=Math.sin(c)/2*Math.sqrt(2);d=Math.pow(10,b.gain.Get(0)/40);k=1/((d+1)-(d-1)*e+2*Math.sqrt(d)*m);b._a1=2*((d-1)-(d+1)*e)*k;b._a2=((d+1)-(d-1)*e-2*Math.sqrt(d)*m)*k;b._b0=d*((d+1)+(d-1)*e+2*Math.sqrt(d)*m)*k;b._b1=-2*d*((d-1)+(d+1)*e)*k;b._b2=d*((d+1)+(d-1)*e-2*Math.sqrt(d)*m)*k;break;case"peaking":case 5:m=Math.sin(c)/(2*h);d=Math.pow(10,b.gain.Get(0)/40);k=1/(1+m/d);b._a1=-2*e*k;b._a2=(1-m/d)*k;b._b0=(1+m*d)*k;b._b1=-2*e*k;b._b2=(1-m*d)*k;break;case"notch":case 6:m=Math.sin(c)/(2*h);k=1/(1+m);b._a1=-2*e*k;b._a2=(1-m)*k;b._b0=b._b2=k;b._b1=-2*e*k;break;case"allpass":case 7:m=Math.sin(c)/(2*h);k=1/(1+m);b._a1=-2*e*k;b._a2=(1-m)*k;b._b0=(1-m)*k;b._b1=-2*e*k;b._b2=(1+m)*k;break}};this._Process=function(){var h,d,b,g;this.frequency._Process();this.detune._Process();this.Q._Process();this.gain._Process();this._Setup(this);var f=this._nodein[0].inbuf.buf;var e=this._nodeout[0].outbuf.buf;for(var c=0;c<waapisimBufSize;++c){h=f[0][c];d=f[1][c];b=this._b0*h+this._b1*this._x1l+this._b2*this._x2l-this._a1*this._y1l-this._a2*this._y2l;g=this._b0*d+this._b1*this._x1r+this._b2*this._x2r-this._a1*this._y1r-this._a2*this._y2r;this._x2l=this._x1l;this._x2r=this._x1r;this._x1l=h;this._x1r=d;this._y2l=this._y1l;this._y2r=this._y1r;this._y1l=b;this._y1r=g;e[0][c]=b;e[1][c]=g}this._nodeout[0].NodeEmitBuf();this._nodein[0].NodeClear();this.frequency.Clear(false);this.detune.Clear(false);this.Q.Clear(false);this.gain.Clear(false)}};waapisimBiquadFilter.LOWPASS=waapisimBiquadFilter.prototype.LOWPASS=0;waapisimBiquadFilter.HIGHPASS=waapisimBiquadFilter.prototype.HIGHPASS=1;waapisimBiquadFilter.BANDPASS=waapisimBiquadFilter.prototype.BANDPASS=2;waapisimBiquadFilter.LOWSHELF=waapisimBiquadFilter.prototype.LOWSHELF=3;waapisimBiquadFilter.HIGHSHELF=waapisimBiquadFilter.prototype.HIGHSHELF=4;waapisimBiquadFilter.PEAKING=waapisimBiquadFilter.prototype.PEAKING=5;waapisimBiquadFilter.NOTCH=waapisimBiquadFilter.prototype.NOTCH=6;waapisimBiquadFilter.ALLPASS=waapisimBiquadFilter.prototype.ALLPASS=7;waapisimGain=function(a){waapisimAudioNode.call(this,waapisimBufSize,1,1);this._nodetype="Gain";waapisimDebug("create "+this._nodetype+this._nodeId);this.context=a;this.playbackState=0;this.gain=new waapisimAudioParam(a,this,0,1,1);this._nodein[0].NodeClear();this._Process=function(){var d;this.gain._Process();var f=this._nodein[0].inbuf.buf;switch(this._nodeout[0].to.length){case 0:break;case 1:var c=this._nodeout[0].to[0].inbuf.buf;for(d=0;d<waapisimBufSize;++d){var e=this.gain.Get(d);c[0][d]+=f[0][d]*e;c[1][d]+=f[1][d]*e}break;default:for(d=0;d<waapisimBufSize;++d){this._nodeout[0].NodeEmit(d,f[0][d]*this.gain.Get(d),f[1][d]*this.gain.Get(d))}break}this._nodein[0].NodeClear();this.gain.Clear(true)}};waapisimDelay=function(a){waapisimAudioNode.call(this,waapisimBufSize,1,1);this._nodetype="Delay";waapisimDebug("create "+this._nodetype+this._nodeId);this.context=a;this.playbackState=0;this.delayTime=new waapisimAudioParam(a,this,0,1,0);this._bufl=new Float32Array(waapisimSampleRate);this._bufr=new Float32Array(waapisimSampleRate);for(var b=0;b<waapisimSampleRate;++b){this._bufl[b]=this._bufr[b]=0}this._index=0;this._offscur=0;this._Process=function(){this.delayTime._Process();var g=this._nodein[0].inbuf.buf;var f=this._nodeout[0].outbuf.buf;var h=Math.floor(this.delayTime.Get(0)*this.context.sampleRate);if(h<0){h=0}if(h>=this.context.sampleRate){h=this.context.sampleRate-1}var e=(h-this._offscur)/waapisimBufSize;for(var d=0;d<waapisimBufSize;++d){var c=this._index-(this._offscur|0);if(c<0){c+=waapisimSampleRate}f[0][d]=this._bufl[c];f[1][d]=this._bufr[c];this._bufl[this._index]=g[0][d];this._bufr[this._index]=g[1][d];if(++this._index>=waapisimSampleRate){this._index=0}this._offscur+=e}this._nodeout[0].NodeEmitBuf();this._nodein[0].NodeClear();this.delayTime.Clear(false)}};waapisimOscillator=function(a){waapisimAudioNode.call(this,waapisimBufSize,0,1);this._nodetype="Osc";waapisimDebug("create "+this._nodetype+this._nodeId);this._targettype=3;this.context=a;this.type=0;this._wavtable=null;this.frequency=new waapisimAudioParam(a,this,1,20000,440);this.detune=new waapisimAudioParam(a,this,-1200,1200,0);this.playbackState=0;this._phase=0;this._whenstart=0;this._whenstop=Number.MAX_VALUE;this.start=this.noteOn=function(b){this._whenstart=b;this.playbackState=1;this.context._RegisterNode(this)};this.stop=this.noteOff=function(b){this._whenstop=b};this.setWaveTable=function(b){this.type=4;this._wavtable=b};this._Process=function(){var k;this.frequency._Process();this.detune._Process();if(this.playbackState==1&&this.context.currentTime>=this._whenstart){this.playbackState=2}if(this.playbackState==2&&this.context.currentTime>=this._whenstop){this.playbackState=3}if(this.playbackState!=2){for(k=0;k<waapisimBufSize;++k){this._nodeout[0].outbuf.buf[0][k]=this._nodeout[0].outbuf.buf[1][k]=0}return}var q,e,c,p,o;var g=this._nodeout[0].outbuf.buf;var m=this._phase;var b=1/this.context.sampleRate;var d=this.frequency;var j=this.detune;switch(this.type){case"sine":case 0:e=0.25;c=1;p=2*Math.PI;o=1/6.78;break;case"square":case 1:e=0.25;c=1;p=100000;o=0;break;case"sawtooth":case 2:e=0.5;c=2;p=2;o=0;break;case"triangle":case 3:e=0.25;c=1;p=4;o=0;break;case"custom":case 4:for(k=0;k<waapisimBufSize;++k){var n=d.Get(k)*Math.pow(2,j.Get(k)/1200);m+=n*b;m=m-Math.floor(m);var h=0;if(this._wavtable){h=this._wavtable.buf[(4096*m)|0]}g[0][k]=g[1][k]=h}this._phase=m;this._nodeout[0].NodeEmitBuf();this.frequency.Clear(true);this.detune.Clear(true);return}for(k=0;k<waapisimBufSize;++k){var n=d.Get(k)*Math.pow(2,j.Get(k)/1200);m+=n*b;m=m-Math.floor(m);if(c-m<m){q=(c-m-e)*p}else{q=(m-e)*p}var h=q-q*q*q*o;if(h>1){h=1}if(h<-1){h=-1}g[0][k]=g[1][k]=h}this._phase=m;this._nodeout[0].NodeEmitBuf();this.frequency.Clear(true);this.detune.Clear(true)}};waapisimOscillator.SINE=waapisimOscillator.prototype.SINE=0;waapisimOscillator.SQUARE=waapisimOscillator.prototype.SQUARE=1;waapisimOscillator.SAWTOOTH=waapisimOscillator.prototype.SAWTOOTH=2;waapisimOscillator.TRIANGLE=waapisimOscillator.prototype.TRIANGLE=3;waapisimOscillator.CUSTOM=waapisimOscillator.prototype.CUSTOM=4;waapisimOscillator.UNSCHEDULED_STATE=waapisimOscillator.prototype.UNSCHEDULED_STATE=0;waapisimOscillator.SCHEDULED_STATE=waapisimOscillator.prototype.SCHEDULED_STATE=1;waapisimOscillator.PLAYING_STATE=waapisimOscillator.prototype.PLAYING_STATE=2;waapisimOscillator.FINISHED_STATE=waapisimOscillator.prototype.FINISHED_STATE=3;waapisimAnalyser=function(a){waapisimAudioNode.call(this,waapisimBufSize,1,1);this._nodetype="Analyser";waapisimDebug("create "+this._nodetype+this._nodeId);this.context=a;this.playbackState=0;this.fftSize=512;this.frequencyBinCount=128;this.minDecibels=-100;this.maxDecibels=-30;this.smoothingTimeConstant=0;this._fftInData=new Array(256);this._fftOutData=new Array(128);this._timeData=new Array(256);this._fftIndex=0;this._fftCurrentSize=0;this._fftrev=new Array(256);this._fft=function(p,z,c){var e=p>>1;var k=-2*Math.PI;var r,y,s,w,u,q,x,B,d,g,o;for(y=1;(r=y<<1)<=p;y=r){s=y>>1;k*=0.5;for(q=0;q<p;q+=r){B=q+y;g=z[B];z[B]=z[q]-g;z[q]+=g}for(w=1;w<s;++w){var b=Math.cos(k*w);var f=Math.sin(k*w);for(u=0;u<p;u+=r){q=u+w;x=u+y-w;B=u+y+w;d=u+r-w;g=b*z[B]+f*z[d];o=b*z[d]-f*z[B];z[B]=-z[x]+o;z[d]=z[x]+o;z[x]=z[q]-g;z[q]=z[q]+g}}}z[0]=Math.min(1e-100,Math.abs(z[0]/p));var A=Math.min(1,Math.max(0,this.smoothingTimeConstant));c[0]=c[0]*A+(1-A)*z[0];for(w=0;w<e;++w){var h=Math.sqrt(z[w]*z[w]+z[p-w]*z[p-w])/p;if(h<1e-100){h=1e-100}c[w]=c[w]*A+(1-A)*h}};this.getByteFrequencyData=function(f){var d=this.maxDecibels-this.minDecibels;for(var b=Math.min(f.length,this.frequencyBinCount),e=0;e<b;++e){var c=20*Math.LOG10E*Math.log(this._fftOutData[e]);f[e]=((Math.min(this.maxDecibels,Math.max(this.minDecibels,c))-this.minDecibels)*255/d)|0}};this.getFloatFrequencyData=function(d){for(var b=Math.min(d.length,this.frequencyBinCount),c=0;c<b;++c){d[c]=20*Math.LOG10E*Math.log(this._fftOutData[c])}};this.getByteTimeDomainData=function(e){for(var b=Math.min(this.frequencyBinCount,e.length),d=0;d<b;++d){var c=Math.min(1,Math.max(-1,this._timeData[d]));e[d]=c*127+128}};this._Process=function(){var g,f,e;var d=this._nodein[0].inbuf.buf;if(this.fftSize!=this._fftCurrentSize){var b=this.fftSize;for(g=0;g<b;++g){this._fftInData[g]=this._fftOutData[g]=0}this._fftCurrentSize=b;this.frequencyBinCount=b*0.5;this._fftIndex=0;this._fftrev[0]=0;this._fftrev[b-1]=b-1;for(g=0,f=1;f<b-1;++f){for(e=b>>1;e>(g^=e);e>>=1){}this._fftrev[f]=g}}for(g=0;g<waapisimBufSize;++g){var h=d[0][g];var c=d[1][g];this._nodeout[0].NodeEmit(g,h,c);var m=this._timeData[this._fftIndex]=(h+c)*0.5;var o=2*Math.PI*this._fftIndex/this._fftCurrentSize;this._fftInData[this._fftrev[this._fftIndex]]=m*(0.5-0.5*Math.cos(o));if(++this._fftIndex>=this._fftCurrentSize){this._fftIndex=0;this._fft(this._fftCurrentSize,this._fftInData,this._fftOutData)}}this._nodein[0].NodeClear()}};waapisimConvolver=function(a){waapisimAudioNode.call(this,waapisimBufSize,1,1);this._nodetype="Convolver";waapisimDebug("create "+this._nodetype+this._nodeId);this.context=a;this.playbackState=0;this.buffer=null;this.normalize=true;this._scale=1;this._analyzed=null;this._dlybufsize=waapisimSampleRate*5;this._dlybuf=new waapisimAudioBuffer(2,this._dlybufsize,44100);this._dlyidx=0;this._tapsize=20;this._tap=[];this._kernel=null;this._sum=[];this._sum[0]=[];this._sum[1]=[];this._bitrev=[];this._bitrev[0]=0;this._bitrev[waapisimBufSize-1]=waapisimBufSize-1;var d,c,b;for(d=0,c=1;c<waapisimBufSize-1;++c){for(b=waapisimBufSize>>1;b>(d^=b);b>>=1){}this._bitrev[c]=d}for(d=0;d<2;++d){for(c=0;c<2;++c){this._sum[d][c]=new Float32Array(waapisimSampleRate)}}this._Normalize=function(k){var g=0.00125;var p=44100;var s=0.000125;var t=2;var f=k.length;var e=0;for(var m=0;m<t;++m){var o=0;var r=0;var h=f;while(h--){var q=k.buf[m][o++];r+=q*q}e+=r}e=Math.sqrt(e/(t*f));if(isFinite(e)===false||isNaN(e)||e<s){e=s}var j=1/e;j*=g;return j};this._Fft=function(p,A){var q,x,h,u,t,s,g,w,B,o;var f,y,e,r,z;u=0;for(t=1;t<p-1;t++){for(s=p>>1;s>(u^=s);s>>=1){}if(t<u){r=A[t];A[t]=A[u];A[u]=r}}f=-2*Math.PI;for(x=1;(q=x<<1)<=p;x=q){h=x>>1;f*=0.5;for(g=0;g<p;g+=q){B=g+x;r=A[B];A[B]=A[g]-r;A[g]+=r}for(u=1;u<h;u++){y=Math.cos(f*u);e=Math.sin(f*u);for(t=0;t<p;t+=q){g=t+u;w=t+x-u;B=t+x+u;o=t+q-u;r=y*A[B]+e*A[o];z=y*A[o]-e*A[B];A[B]=-A[w]+z;A[o]=A[w]+z;A[w]=A[g]-r;A[g]=A[g]+r}}}};this._Fft2=function(g,p,x){var h,t,s,r,q;var u,e,o,w;var f=2*Math.PI;s=0;for(r=1;r<g-1;r++){for(q=g>>1;q>(s^=q);q>>=1){}if(r<s){o=p[r];w=x[r];p[r]=p[s];x[r]=x[s];p[s]=o;x[s]=w}}for(t=1;(h=t<<1)<=g;t=h){f*=0.5;for(s=0;s<t;s++){u=Math.cos(f*s);e=Math.sin(f*s);for(r=s;r<g;r+=h){q=r+t;o=u*p[q]-e*x[q];w=u*x[q]+e*p[q];p[q]=p[r]-o;x[q]=x[r]-w;p[r]+=o;x[r]+=w}}}for(s=0;s<g;++s){p[s]=p[s]/g}};this._Process=function(){var e=this._nodein[0].inbuf.buf;var h=(waapisimBufSize*0.5)|0;var C,A,z,w,s,g,f;if(this.buffer!==null){var F=[];for(C=0;C<4;++C){F[C]=new waapisimAudioBuffer(2,waapisimBufSize,44100)}if(this.buffer!=this._analyzed){this._scale=1;if(this.normalize){this._scale=this._Normalize(this.buffer)}var D=this.buffer.length;for(C=0,s=0;C<this._tapsize;++C){var n=(C*D/this._tapsize)|0;var q=n-s;g=0;f=0;if(q>0){while(s<n){g+=this.buffer.buf[0][s]*this.buffer.buf[0][s];f+=this.buffer.buf[1][s]*this.buffer.buf[1][s];++s}g=Math.sqrt(g)*this._scale*0.5;f=Math.sqrt(f)*this._scale*0.5}this._tap[C]=[n,g,f]}this._kernel=new waapisimAudioBuffer(2,waapisimBufSize,44100);var t=0,m=0;for(w=Math.min(this.buffer.length,waapisimBufSize*4),C=0,A=0,z=0;C<w;++C){g=this.buffer.buf[0][C];f=this.buffer.buf[1][C];F[z].buf[0][A]=g;F[z].buf[1][A]=f;t+=(g*g+f*f);if(++A>=waapisimBufSize){if(t>m){this._kernel=F[z];m=t}A=0;t=0;++z}}if(t>m||this._kernel===null){this._kernel=F[z]}this._Fft(waapisimBufSize,this._kernel.buf[0]);this._Fft(waapisimBufSize,this._kernel.buf[1]);this._analyzed=this.buffer}this._Fft(waapisimBufSize,e[0]);this._Fft(waapisimBufSize,e[1]);this._sum[0][0][0]=this._sum[1][0][0]=this._sum[0][1][0]=this._sum[1][1][0]=0;for(C=1,A=waapisimBufSize-1;C<h;++C,--A){var E=e[0][C]*this._kernel.buf[0][C]-e[0][A]*this._kernel.buf[0][A];var y=e[0][C]*this._kernel.buf[0][A]+e[0][A]*this._kernel.buf[0][C];this._sum[0][0][C]=E;this._sum[0][0][A]=E;this._sum[0][1][C]=-y;this._sum[0][1][A]=y;var B=e[1][C]*this._kernel.buf[1][C]-e[1][A]*this._kernel.buf[1][A];var u=e[1][C]*this._kernel.buf[1][A]+e[1][A]*this._kernel.buf[1][C];this._sum[1][0][C]=B;this._sum[1][0][A]=B;this._sum[1][1][C]=-u;this._sum[1][1][A]=u}this._Fft2(waapisimBufSize,this._sum[0][0],this._sum[0][1]);this._Fft2(waapisimBufSize,this._sum[1][0],this._sum[1][1]);for(C=0;C<waapisimBufSize;++C){var o=(h-Math.abs(C-h))/h;this._dlybuf.buf[0][this._dlyidx]=this._sum[0][0][C]*o;this._dlybuf.buf[1][this._dlyidx]=this._sum[1][0][C]*o;g=0;f=0;for(w=this._tap.length,A=0;A<w;++A){var r=this._dlyidx-this._tap[A][0];if(r<0){r+=this._dlybufsize}g+=this._dlybuf.buf[0][r]*this._tap[A][1];f+=this._dlybuf.buf[1][r]*this._tap[A][2]}this._nodeout[0].NodeEmit(C,g,f);if(++this._dlyidx>=this._dlybufsize){this._dlyidx=0}}}this._nodein[0].NodeClear()}};waapisimDynamicsCompressor=function(a){waapisimAudioNode.call(this,waapisimBufSize,1,1);this._nodetype="DynComp";waapisimDebug("create "+this._nodetype+this._nodeId);this.context=a;this.playbackState=0;this.threshold=new waapisimAudioParam(a,this,-100,0,-24);this.knee=new waapisimAudioParam(a,this,0,40,30);this.ratio=new waapisimAudioParam(a,this,1,20,12);this.reduction=new waapisimAudioParam(a,this,-20,0,0);this.attack=new waapisimAudioParam(a,this,0,1,0.003);this.release=new waapisimAudioParam(a,this,0,1,0.25);this._maxl=0;this._maxr=0;this._gain=1;this._Process=function(){this.threshold._Process();this.knee._Process();this.ratio._Process();this.attack._Process();this.release._Process();var e=this._nodein[0].inbuf.buf;var b=this.release.Get(0)*waapisimSampleRate;b=Math.pow(1/3.16,1/b);var c=this.attack.Get(0)*waapisimSampleRate;c=Math.pow(1/3.16,1/c);var j=this.reduction.value;var d=Math.pow(10,this.threshold.Get(0)/20);var h=Math.pow(10,this.knee.Get(0)/20*0.5);var k=1/Math.sqrt(d)/Math.pow(10,this.knee.Get(0)/80);var o=0.99105;var p=this.ratio.Get(0);if(p<=1){p=1}for(var f=0;f<waapisimBufSize;++f){this._maxl=o*this._maxl+(1-o)*e[0][f]*e[0][f];this._maxr=o*this._maxr+(1-o)*e[1][f]*e[1][f];var n=Math.sqrt(Math.max(this._maxl,this._maxr))*1.414;if(n>d){var q=Math.pow(d*Math.min(h,n/d)/n,1-1/p);this._gain=q+(this._gain-q)*c}var m=this._gain*k;this._nodeout[0].NodeEmit(f,e[0][f]*m,e[1][f]*m);this._gain=1+(this._gain-1)*b}this.reduction.value=this.reduction.computedValue=j;this._nodein[0].NodeClear();this.threshold.Clear(false);this.knee.Clear(false);this.ratio.Clear(false);this.reduction.Clear(false);this.attack.Clear(false);this.release.Clear(false)}};waapisimPanner=function(a){waapisimAudioNode.call(this,waapisimBufSize,1,1);this._nodetype="Panner";waapisimDebug("create "+this._nodetype+this._nodeId);this.context=a;this.playbackState=0;this.panningModel=0;this.distanceModel=1;this.refDistance=1;this.maxDistance=10000;this.rolloffFactor=1;this.coneInnerAngle=360;this.coneOuterAngle=360;this.coneOuterGain=0;this.px=0;this.py=0;this.pz=0;this.setPosition=function(b,d,c){this.px=b;this.py=d;this.pz=c};this.setOrientation=function(b,d,c){};this.setVelocity=function(b,d,c){};this._Process=function(){var e=this._nodein[0].inbuf.buf;var c=this.context.listener;var p=this.px-c.px;var n=this.py-c.py;var m=this.pz-c.pz;var j=Math.max(1,Math.sqrt(p*p+n*n+m*m));var o=p-m;var g=-p-m;var h=Math.sqrt(o*o+g*g);var b;switch(this.distanceModel){case"linear":case 0:b=1-this.rolloffFactor*(j-this.refDistance)/(this.maxDistance-this.refDistance);break;case"inverse":case 1:b=this.refDistance/(this.refDistance+this.rolloffFactor*(j-this.refDistance));break;case"exponential":case 2:b=Math.pow(j/this.refDistance,-this.rolloffFactor);break}if(h===0){o=g=Math.sqrt(2)*b}else{o=o/h;g=g/h;var k=Math.sqrt(o*o+g*g);o=o/k*2*b;g=g/k*2*b}for(var f=0;f<waapisimBufSize;++f){this._nodeout[0].NodeEmit(f,e[0][f]*g,e[1][f]*o)}this._nodein[0].NodeClear()}};waapisimPanner.EQUALPOWER=waapisimPanner.prototype.EQUALPOWER=0;waapisimPanner.HRTF=waapisimPanner.prototype.HRTF=1;waapisimPanner.SOUNDFIELD=waapisimPanner.prototype.SOUNDFIELD=2;waapisimPanner.LINEAR_DISTANCE=waapisimPanner.prototype.LINEAR_DISTANCE=0;waapisimPanner.INVERSE_DISTANCE=waapisimPanner.prototype.INVERSE_DISTANCE=1;waapisimPanner.EXPONENTIAL_DISTANCE=waapisimPanner.prototype.EXPONENTIAL_DISTANCE=2;waapisimChannelSplitter=function(a,b){this._nodetype="ChSplit";waapisimDebug("create "+this._nodetype+this._nodeId);if(typeof(b)==="undefined"){b=6}waapisimAudioNode.call(this,waapisimBufSize,1,b);this.context=a;this.playbackState=0;this._Process=function(){var d=this._nodein[0].inbuf.buf;for(var c=0;c<waapisimBufSize;++c){this._nodeout[0].NodeEmit(c,d[0][c],d[0][c]);this._nodeout[1].NodeEmit(c,d[1][c],d[1][c])}this._nodein[0].NodeClear()}};waapisimChannelMerger=function(a,b){this._nodetype="ChMerge";waapisimDebug("create "+this._nodetype+this._nodeId);if(typeof(b)==="undefined"){b=6}waapisimAudioNode.call(this,waapisimBufSize,b,1);this.context=a;this.playbackState=0;this._Process=function(){var e=this._nodein[0].inbuf.buf;var d=this._nodein[1].inbuf.buf;for(var c=0;c<waapisimBufSize;++c){this._nodeout[0].NodeEmit(c,(e[0][c]+e[1][c])*0.5,(d[0][c]+d[1][c])*0.5)}this._nodein[0].NodeClear();this._nodein[1].NodeClear()}};waapisimWaveShaper=function(a){waapisimAudioNode.call(this,waapisimBufSize,1,1);this._nodetype="Shaper";waapisimDebug("create "+this._nodetype+this._nodeId);this.context=a;this.playbackState=0;this.curve=null;var b;this._Process=function(){var e=this._nodein[0].inbuf.buf;var f=this.curve;if(f!==null){var c=f.length-1;if(c>=0){for(b=0;b<waapisimBufSize;++b){var g=Math.max(-1,Math.min(1,e[0][b]));var d=Math.max(-1,Math.min(1,e[1][b]));g=f[((g+1)*0.5*c+0.5)|0];d=f[((d+1)*0.5*c+0.5)|0];this._nodeout[0].NodeEmit(b,g,d)}this._nodein[0].NodeClear();return}}for(b=0;b<waapisimBufSize;++b){this._nodeout[0].NodeEmit(b,e[0][b],e[1][b])}this._nodein[0].NodeClear()}};waapisimAudioParam=function(b,e,d,a,f){this.context=b;this._targettype=0;this.node=e;this.value=f;this.computedValue=f;this.minValue=d;this.maxValue=a;this.defaultValue=f;this.from=[];this.inbuf={};this.inbuf.buf=[];this.inbuf.buf[0]=new Float32Array(waapisimBufSize);this.inbuf.buf[1]=new Float32Array(waapisimBufSize);this.automation=[];this.deltaAdd=0;this.deltaMul=1;this.deltaTarget=0;this.currentEvent=null;for(var c=0;c<waapisimBufSize;++c){this.inbuf.buf[0][c]=this.inbuf.buf[1][c]=0}this.AddEvent=function(k){var j=k[0];for(var g=this.automation.length,h=0;h<g;++h){if(this.automation[h][0]>j){break}}this.automation.splice(h,0,k)};this.setValueAtTime=function(g,h){this.AddEvent([h,0,g])};this.linearRampToValueAtTime=function(g,h){this.AddEvent([h,1,g])};this.exponentialRampToValueAtTime=function(g,h){this.AddEvent([h,2,g])};this.setTargetAtTime=this.setTargetValueAtTime=function(g,h,j){this.AddEvent([h,3,g,j])};this.setValueCurveAtTime=function(g,h,j){this.AddEvent([h,4,g,j])};this.cancelScheduledValues=function(j){for(var g=this.automation.length,h=0;h<g;++h){if(this.automation[h][0]>=j){this.automation.length=h;return}}};this._Process=function(){this.value+=this.deltaAdd;this.value=(this.value-this.deltaTarget)*this.deltaMul+this.deltaTarget;if(this.currentEvent!==null){if(this.currentEvent[1]==4){var g=(this.currentEvent[2].length-1)*(this.context.currentTime-this.currentEvent[0])/this.currentEvent[3];this.value=this.currentEvent[2][Math.min(this.currentEvent[2].length-1,g)|0]}}if(this.automation.length>0){if(this.context.currentTime>=this.automation[0][0]){this.deltaAdd=0;this.deltaMul=1;this.deltaTarget=0;this.currentEvent=this.automation.shift();switch(this.currentEvent[1]){case 0:case 1:case 2:this.value=this.currentEvent[2];break;case 3:this.deltaMul=Math.pow(0.367879,1/(waapisimSampleRate/waapisimBufSize*this.currentEvent[3]));this.deltaTarget=this.currentEvent[2];break}if(this.automation.length>0){var h=waapisimSampleRate/waapisimBufSize*(this.automation[0][0]-this.context.currentTime);switch(this.automation[0][1]){case 1:this.deltaAdd=(this.automation[0][2]-this.value)/h;break;case 2:this.deltaMul=Math.pow(this.automation[0][2]/this.value,1/h);break}}}}};this.Get=function(g){this.computedValue=this.value+(this.inbuf.buf[0][g]+this.inbuf.buf[1][g])*0.5;return this.computedValue};this.Clear=function(h){if(h){for(var g=0;g<waapisimBufSize;++g){this.inbuf.buf[0][g]=this.inbuf.buf[1][g]=0}}else{this.inbuf.buf[0][0]=this.inbuf.buf[1][0]=0}}}}var SoundVisualizer=Class.extend({init:function(c,b,a){this.canvas=$('<canvas width="'+b+'" height="'+a+'">');this.w=b;this.h=a;c.append(this.canvas);this.ctx=this.canvas[0].getContext("2d")},visualizeFrequencyData:function(e){this.ctx.fillStyle="rgba(255,255,255,0.2)";this.ctx.fillRect(0,0,this.w,this.h);this.ctx.fillStyle="rgba(200,0,0,0.5)";var d=Math.floor((e.length*0.33)/this.w);var a=0;var c=0;for(var b=0;b<this.w;b++){a=e[b*d];c=(a/255)*this.h;this.ctx.fillRect(b,(this.h-c),1,c)}},visualizeTimeDomainData:function(e){this.ctx.fillStyle="rgba(255,255,255,0.2)";this.ctx.fillRect(0,0,this.w,this.h);this.ctx.strokeStyle="rgba(200,0,0,0.5)";var d=Math.floor(e.length/this.w);var a=0;var c=0;this.ctx.beginPath();this.ctx.moveTo(0,(e[0]/255)*this.h);for(var b=1;b<this.w;b++){a=e[b*d];c=(a/255)*this.h;this.ctx.lineTo(b,c)}this.ctx.stroke()},clear:function(){this.ctx.fillStyle="rgba(255,255,255,1)";this.ctx.fillRect(0,0,this.w,this.h)}});var BaseNode=Class.extend({init:function(b,a){this.idx=b;this.myConnections=new Array();this.c=a},createMainEl:function(a,m,o,g,n){var d=this;var c=this.el=$("<div>");c.addClass("node");if(g!=undefined){c.css("height",g)}if(n!=undefined){c.css("width",n)}$("body").append(c);c.draggable({stack:"div.node",containment:"parent",drag:function(){d.updateConnectionLines()},});c.css("position","absolute");var p=$("<img>").attr("src","img/ajax-loader.gif").addClass("loaderImg");this.loader=$("<div>").addClass("loaderOverlay");this.loader.append(p);c.append(this.loader);this.loader.hide();var f=$("<div>");f.addClass("nodeheader");f.append($('<i class="'+this.icon+'">'));f.append($('<a href="#" rel="tooltip" title="'+this.tooltip+'">').html("&nbsp;"+this.name).tooltip());c.append(f);if(o){var j=$("<div>");j.addClass("close");j.html("x");j.on("click",function(){$(".line").each(function(){var q=$(this);var s=q.attr("data-fromIdx");var r=q.attr("data-toIdx");if(s==d.idx||r==d.idx){q.fadeOut(700,function(){q.remove()})}});c.fadeOut(700,function(){for(var r in d.myConnections){d.disconnectFrom(d.myConnections[r])}d.shutdown();var q=d.el.height()+2;d.el.remove();d.deleted=true;for(var r=d.idx+1;r<nodes.length;r++){nodes[r].el.offset({top:nodes[r].el.offset().top+q})}})})}f.append(j);var k=null;if(a){var b=$("<div>");b.draggable({revert:true,snap:".nodedrop",start:function(){k=d.createConnectionLine(d.el,b,null,null,true)},drag:function(){var q=d.getLinePosData(d.el,b,true);d.updateConnectionLine(k,q)},stop:function(){k.parent().remove()}});b.droppable({accept:".nodedrop",drop:function(s,t){var r=$(t.draggable[0]);var q=r.attr("data-nodeIndex");var w=nodes[d.idx];var u=nodes[q];$(".templine").remove();if(w.connectTo(u)){u.createConnectionLine(w.el,u.el,w.idx,u.idx,false);u.updateConnectionLines()}}});b.addClass("nodedrag");b.addClass("nodehandle");b.attr("data-nodeIndex",this.idx);b.css({position:"absolute",top:c.height()/2-12+"px",left:c.width()+8+"px"});c.append(b)}if(m){var e=$("<div>");e.addClass("nodedrop");e.addClass("nodehandle");e.attr("data-nodeIndex",this.idx);e.draggable({revert:true,snap:".nodedrag",start:function(){k=d.createConnectionLine(d.el,e,null,null,true)},drag:function(){var q=d.getLinePosData(d.el,e,true,true);d.updateConnectionLine(k,q,true)},stop:function(){k.parent().remove()}});e.droppable({accept:".nodedrag",drop:function(s,t){var r=$(t.draggable[0]);var q=r.attr("data-nodeIndex");var w=nodes[q];var u=nodes[d.idx];$(".templine").remove();if(w.connectTo(u)){u.createConnectionLine(w.el,u.el,w.idx,u.idx,false);u.updateConnectionLines()}}});e.css({position:"absolute",top:c.height()/2-12+"px",left:-28+"px"});c.append(e)}var h=$("<div>");h.addClass("nodebody");c.append(h);c.offset({top:200,left:200});c.hide();c.fadeIn(700);return h},connectTo:function(c){if(this.myConnections.indexOf(c)!=-1){return false}var a=c.getConnections();for(var b in a){this.thingy.connect(a[b])}this.myConnections.push(c);return true},disconnectFrom:function(d){var b=d.getConnections();for(var c in b){this.thingy.disconnect(b[c])}var a=this.myConnections.indexOf(d);if(a!=-1){this.myConnections.splice(a,1)}},getConnections:function(){var a=new Array();a[0]=this.thingy;return a},createConnectionLine:function(h,f,d,e,b){var g=this.getLinePosData(h,f,b);var c=$("<div>").appendTo("body").addClass("linecont").css({position:"absolute","webkit-transform":g.transform,"-moz-transform":g.transform,transform:g.transform}).width(g.length);c.offset({left:g.left,top:g.top-connLineWidth/2});var a=$("<div>").addClass("line").attr({"data-fromIdx":d,"data-toIdx":e}).width(g.length);if(b){c.addClass("templine")}else{c.on("click",function(){var k=nodes[a.attr("data-fromIdx")];var j=nodes[a.attr("data-toIdx")];c.fadeOut(700,function(){k.disconnectFrom(j);$(this).remove()})})}c.append(a);return a},updateConnectionLines:function(){var a=this;$(".line").each(function(){var b=$(this);var e=nodes[b.attr("data-fromIdx")].el;var c=nodes[b.attr("data-toIdx")].el;var d=a.getLinePosData(e,c,false);a.updateConnectionLine(b,d)})},updateConnectionLine:function(a,b){a.parent().css({"webkit-transform":b.transform,"-moz-transform":b.transform,transform:b.transform}).width(b.length).offset({left:b.left,top:b.top-connLineWidth/2});a.width(b.length)},getLinePosData:function(j,g,s,n){var b=j.offset();var m=g.offset();var f=j.width();var k=j.height();var r=g.height();var e=b.left+(n?2:f);var q=b.top+k/2;var d=m.left;var o=m.top+r/2;if(s){d+=10}else{e+=25;d-=15}var p=Math.atan2(o-q,d-e);var h=p*180/Math.PI;var c=Math.abs(Math.sin(p)*connLineWidth/2);return{length:Math.sqrt((e-d)*(e-d)+(q-o)*(q-o)),transform:"rotate("+h+"deg)",top:q<o?q+c:q-(q-o)+c,left:e<d?e-c:e-(e-d)-c}},shutdown:function(){}});var BiquadFilterNode=BaseNode.extend({init:function(k,d){this._super(k,d);this.shortName="bfn";this.thingy=context.createBiquadFilter();this.name="Pass";this.icon="icon-signal";this.tooltip="Lets different frequencies of the audio input through";var b=this.createMainEl(true,true,true,200);var j=this.thingy;var g=this;if(!d){this.c={type:"lowpass",freq:0.8,q:0.2}}var f=function(p){g.c.type=p;switch(p){case"highpass":j.type=j.HIGHPASS;break;case"lowpass":j.type=j.LOWPASS;break;case"bandpass":j.type=j.BANDPASS;break}};var m=function(r,p){g.c.freq=p.value;var s=30;var t=context.sampleRate/2;var q=Math.log(t/s)/Math.LN2;var u=Math.pow(2,q*(p.value-1));j.frequency.value=t*u;h.html("Frequency "+Math.floor(j.frequency.value)+" Hz")};var n=function(q,p){g.c.q=p.value;j.Q.value=p.value*30;c.html("Quality "+Math.floor(j.Q.value))};var a=$("<select>");a.append($("<option>").html("lowpass"));a.append($("<option>").html("highpass"));a.append($("<option>").html("bandpass"));a.val(this.c.type);a.on("change",function(){f(this.value)});b.append($('<a href="#" rel="tooltip" title="Type of pass effect">').tooltip().html("Type"));b.append(a);b.append($("<br/>"));b.append($("<br/>"));f(this.c.type);var e=$("<div>");var h=$('<a href="#" rel="tooltip" title="The cutoff frequency">').tooltip();e.slider({min:0,max:1,step:0.01,value:this.c.freq,slide:m});b.append(h);b.append(e);b.append($("<br/>"));m(null,{value:this.c.freq});var o=$("<div>");var c=$('<a href="#" rel="tooltip" title="Controls how peaked the response will be at the cutoff frequency">').tooltip();o.slider({min:0,max:1,step:0.01,value:this.c.q,slide:n});b.append(c);b.append(o);n(null,{value:this.c.q})}});var ConvolverNode=BaseNode.extend({init:function(h,c){this._super(h,c);this.shortName="cn";this.thingy=context.createConvolver();this.name="Convolver";this.icon="icon-random";this.tooltip="Applies a linear convolution effect given an impulse response";var a=this.createMainEl(true,true,true,115);var k=this.thingy;var f=this;if(!c){this.c={conv:"cardiod-rear-levelled",norm:true}}var j=function(m){f.c.conv=m;f.loader.fadeIn("fast");var n=new XMLHttpRequest();n.open("GET","conv/"+m+".wav",true);n.responseType="arraybuffer";n.onload=function(){k.buffer=context.createBuffer(n.response,false);f.loader.fadeOut("fast")};n.send()};var e=function(){f.c.norm=this.checked;k.normalize.value=this.checked};var d=$("<select>");d.on("change",function(){j(this.value)});d.append($("<option>").html("cardiod-rear-levelled"));d.append($("<option>").html("comb-saw1"));d.append($("<option>").html("comb-saw2"));d.append($("<option>").html("cosmic-ping-long"));d.append($("<option>").html("diffusor3"));d.append($("<option>").html("dining-far-kitchen"));d.append($("<option>").html("dining-living-true-stereo"));d.append($("<option>").html("feedback-spring"));d.append($("<option>").html("filter-lopass160"));d.append($("<option>").html("filter-rhythm1"));d.append($("<option>").html("filter-rhythm3"));d.append($("<option>").html("filter-telephone"));d.append($("<option>").html("impulse-rhythm2"));d.append($("<option>").html("kitchen"));d.append($("<option>").html("kitchen-true-stereo"));d.append($("<option>").html("living-bedroom-leveled"));d.append($("<option>").html("matrix6-backwards"));d.append($("<option>").html("matrix-reverb2"));d.append($("<option>").html("matrix-reverb3"));d.append($("<option>").html("s2_r4_bd"));d.append($("<option>").html("spatialized4"));d.append($("<option>").html("spatialized5"));d.append($("<option>").html("spreader50-65ms"));d.append($("<option>").html("wildecho"));d.val(this.c.conv);a.append($('<a href="#" rel="tooltip" title="Impulse response used by the convolver">').tooltip().html("Impulse response"));a.append(d);j(this.c.conv);var g=$("<input>").attr({type:"checkbox",checked:this.c.norm});var b=$('<a href="#" rel="tooltip" title="Controls whether the impulse response will be scaled by an equal-power normalization">').tooltip().html("Normalize");a.append($("<label>").addClass("checkbox").append(g).append(b));g.on("change",e)}});var DelayNode=BaseNode.extend({init:function(c,b){this._super(c,b);this.shortName="deln";this.thingy=context.createDelayNode();this.name="Delay";this.icon="icon-pause";this.tooltip="Delays the incoming audio signal by a certain amount";var h=this.createMainEl(true,true,true,78);var a=this.thingy;var e=this;if(!b){this.c={d:0.8}}var g=function(k,j){e.c.d=j.value;a.delayTime.value=j.value;f.html("Delay "+j.value+" s")};var d=$("<div>");var f=$('<a href="#" rel="tooltip" title="Delay time in seconds">').tooltip();d.slider({min:0,max:0.99,step:0.01,value:this.c.d,slide:g});h.append(f);h.append(d);g(null,{value:this.c.d})}});var DestinationNode=BaseNode.extend({init:function(h,d){this._super(h,d);this.shortName="dstn";this.thingy=context.createAnalyser();this.icon="icon-volume-up";this.name="Output";this.tooltip="Represents the final audio destination and is what the user will ultimately hear";var c=this.createMainEl(false,true,false);c.css("margin",0);var g=this.thingy;this.thingy.connect(context.destination);var e=this;if(!d){this.c={vm:0}}var b=$('<a href="#" rel="tooltip" title="Click to change visualization">').tooltip({placement:"bottom"});c.append(b);var a=new SoundVisualizer(b,150,120);a.canvas.on("click",function(){e.c.vm++;if(e.c.vm==2){a.clear()}else{if(e.c.vm==3){e.c.vm=0;window.requestAnimationFrame(j)}}});var f=null;var j=function(){if(f==null){f=new Uint8Array(g.frequencyBinCount)}if(e.c.vm==0){g.getByteTimeDomainData(f);a.visualizeTimeDomainData(f);window.requestAnimationFrame(j)}else{if(e.c.vm==1){g.getByteFrequencyData(f);a.visualizeFrequencyData(f);window.requestAnimationFrame(j)}}};window.requestAnimationFrame(j)},getConnections:function(){var a=new Array();a[0]=context.destination;a[1]=this.thingy;return a}});var DynamicsCompressorNode=BaseNode.extend({init:function(e,w){this._super(e,w);this.shortName="dcn";this.thingy=context.createDynamicsCompressor();this.name="Dynamic Compr";this.icon="icon-bullhorn";this.tooltip="Dynamics compression is very commonly used in musical production and game audio. It lowers the volume of the loudest parts of the signal and raises the volume of the softest parts";var b=this.createMainEl(true,true,true,305);var h=this.thingy;var g=this;if(!w){this.c={t:h.threshold.defaultValue,k:h.knee.defaultValue,rat:h.ratio.defaultValue,a:0.1,rel:0.25}}var k=function(z,y){g.c.t=y.value;h.threshold.value=y.value;j.html("Threshold "+y.value+" dB")};var c=function(z,y){g.c.k=y.value;h.knee.value=y.value;q.html("Knee "+y.value+" dB")};var u=function(z,y){g.c.rat=y.value;h.ratio.value=y.value;m.html("Ratio "+y.value)};var d=function(z,y){g.c.a=y.value;h.attack.value=y.value;o.html("Attack "+y.value+" s")};var f=function(z,y){g.c.rel=y.value;h.release.value=y.value;n.html("Release "+y.value+" s")};if(h.threshold==undefined||h.attack==undefined||h.release==undefined){b.append($("<p>").html("Not supported by your browser"));return}var p=$("<div>");var j=$('<a href="#" rel="tooltip" title="The decibel value above which the compression will start taking effect">').tooltip();p.slider({min:h.threshold.minValue,max:h.threshold.maxValue,value:this.c.t,slide:k});b.append(j);b.append(p);b.append($("<br/>"));k(null,{value:this.c.t});var a=$("<div>");var q=$('<a href="#" rel="tooltip" title="A decibel value representing the range above the threshold where the curve smoothly transitions to the "ratio" portion">').tooltip();a.slider({min:h.knee.minValue,max:h.knee.maxValue,value:this.c.k,slide:c});b.append(q);b.append(a);b.append($("<br/>"));c(null,{value:this.c.k});var r=$("<div>");var m=$('<a href="#" rel="tooltip" title="The ratio of compression">').tooltip();r.slider({min:h.ratio.minValue,max:h.ratio.maxValue,value:this.c.rat,slide:u});b.append(m);b.append(r);b.append($("<br/>"));u(null,{value:this.c.rat});var x=$("<div>");var o=$('<a href="#" rel="tooltip" title="The amount of time to increase the gain by 10dB.">').tooltip();x.slider({min:h.attack.minValue,max:h.attack.maxValue,step:0.01,value:this.c.a,slide:d});b.append(o);b.append(x);b.append($("<br/>"));d(null,{value:this.c.a});var t=$("<div>");var n=$('<a href="#" rel="tooltip" title="The amount of time to reduce the gain by 10dB">').tooltip();t.slider({min:h.release.minValue,max:h.release.maxValue,step:0.01,value:this.c.rel,slide:f});b.append(n);b.append(t);b.append($("<br/>"));f(null,{value:this.c.rel});var s=$("<p>");setInterval(function(){s.html("Reduction "+Math.min(h.reduction.value.toPrecision(2),-0.1)+" dB")},100);b.append($('<a href="#" rel="tooltip" title="Current amount of gain reduction">').tooltip().append(s))}});var GainNode=BaseNode.extend({init:function(d,c){this._super(d,c);this.shortName="gn";this.thingy=context.createGainNode();this.name="Gain";this.icon="icon-plus";this.tooltip="Changes the gain of (scales) the incoming audio signal by a certain amount";var g=this.createMainEl(true,true,true,78);var f=this.thingy;var e=this;if(!c){this.c={v:1}}var h=function(k,j){e.c.v=j.value;f.gain.value=j.value*j.value;b.html("Volume "+j.value)};var a=$("<div>");var b=$('<a href="#" rel="tooltip" title="Set gain multiplier">').tooltip();a.slider({min:0,max:3,value:this.c.v,step:0.01,slide:h});g.append(b);g.append(a);h(null,{value:this.c.v})}});var ScriptNode=BaseNode.extend({init:function(e,b){this._super(e,b);this.shortName="scn";this.thingy=context.createJavaScriptNode(4096,1,1);this.thingy.onaudioprocess=function(k){};this.name="Javascript";this.icon="icon-filter";this.tooltip="Can generate or process audio directly using JavaScript. Has inputBuffer inp, outputBuffer out and AudioProcessingEvent ev defined";var g=this.thingy;var c=this;if(!b){this.c={c:"for (var i = 0; i < inp.length; i++) {\n out[i] = inp[i];\n}"}}var a=this.createMainEl(true,true,true,308,241);a.css("width","221px");var f=$("<textarea>");var j=$("<input>");var d=this.thingy.errorMsg=$("<div>");d.css({"float":"right",width:"159px",height:"36px","overflow-y":"auto","overflow-x":"hidden"});var h=function(k){c.c.c=k;var n=null;d.html("");try{n=new Function("ev","this.errorMsg.innerHTML = ''; try { var inp = ev.inputBuffer.getChannelData(0); var out = ev.outputBuffer.getChannelData(0);"+k+"} catch(e) { this.errorMsg.html(e.message); }")}catch(m){d.html(m.message);n=function(o){}}g.onaudioprocess=n;return this};f.attr("cols","30");f.attr("rows","12");f.val(this.c.c);j.attr({type:"button",value:"compile"});j.on("click",function(){h(f.val())});a.append(f);a.append($("<br/>"));a.append(j);a.append(d);h(this.c.c)}});var SourceNode=BaseNode.extend({init:function(k,e){this._super(k,e);this.shortName="son";this.thingy=context.createBufferSource();this.thingy.loop=true;this.name="File";this.icon="icon-file";this.tooltip="Plays an audio file dragged from the filesystem";var d=this.thingy;var f=this;if(!e){this.c={pr:1}}var c=this.createMainEl(true,false,true,175);var m=$("<div>");m.addClass("btn-group");m.css("width","100%");var g=$("<input>");g.attr({type:"button",value:"start",disabled:"true",});g.addClass("btn");g.addClass("btn-primary");g.css("width","50%");g.click(function(){n.removeAttr("disabled");g.attr("disabled","true");d.gain.value=1});m.append(g);var n=$("<input>");n.attr({type:"button",value:"stop",disabled:"true",});n.addClass("btn");n.addClass("btn-primary");n.css("width","50%");n.click(function(){g.removeAttr("disabled");n.attr("disabled","true");d.gain.value=0});m.append(n);c.append(m);var a=function(q,p){f.c.pr=p.value;d.playbackRate.value=p.value;j.html("Rate "+p.value)};var b=$("<div>");var j=$('<a href="#" rel="tooltip" title="Set playback rate multiplier">').tooltip();b.slider({min:0.1,max:3,value:this.c.pr,step:0.05,slide:a});c.append("<br/>");c.append(j);c.append(b);c.append("<br/>");a(null,{value:this.c.pr});var h=$("<div>");h.html("Drag and drop a sound file to me..");c.append(h);var o=this.info2El=$("<div>");o.html("Now connect me to something..");o.hide();c.append(o);c.parent()[0].addEventListener("drop",function(q){q.stopPropagation();q.preventDefault();f.loader.fadeIn("fast");var p=new FileReader();p.onload=function(r){if(context.decodeAudioData){context.decodeAudioData(r.target.result,function(s){d.buffer=s},function(s){alert("could not play that audio");console.log(s);return})}else{d.buffer=context.createBuffer(r.target.result,false)}d.noteOn(0);n.removeAttr("disabled");if(f.myConnections.length==0){o.show("fast")}h.hide("fast");f.loader.fadeOut("fast")};p.readAsArrayBuffer(q.dataTransfer.files[0])},false);c.parent()[0].addEventListener("dragover",function(p){p.stopPropagation();p.preventDefault();return false},false)},connectTo:function(b){var a=this._super(b);this.info2El.hide("fast");return a},getConnections:function(){return new Array()},shutdown:function(){this.thingy.noteOff(0)}});var WaveShaperNode=BaseNode.extend({init:function(d,c){this._super(d,c);this.shortName="wsn";this.thingy=context.createWaveShaper();this.name="WaveShaper";this.icon="icon-tasks";this.tooltip="Implements non-linear distortion effects";var h=this.createMainEl(true,true,true,166,155);var g=this.thingy;var f=this;if(!c){this.c={cu:[0,0.05,0.1,0.15,0.2,0.25,0.3,0.35,0.4,0.45]}}var a=function(k,m){var n=new Float32Array(10);var j=0;$(h).find(".curveRange").each(function(){var o=$(this).slider("value");f.c.cu[j]=o;n[j++]=o});g.curve=n};h.append($('<a href="#" rel="tooltip" title="The shaping curve used for the waveshaping effect">').tooltip().html("Curve"));h.append($("<br/>"));for(var e=0;e<10;e++){var b=$("<div>");b.slider({orientation:"vertical",min:-1,max:1,step:0.01,value:this.c.cu[e],slide:a});b.addClass("curveRange");h.append(b)}a(null,null)}});var OscillatorNode=BaseNode.extend({init:function(m,d){this._super(m,d);this.shortName="on";this.name="Oscillator";this.icon=" icon-chevron-up";this.tooltip="Oscillator represents an audio source generating a periodic waveform";var b=this.createMainEl(true,false,true,183);try{this.thingy=context.createOscillator()}catch(n){b.append($("<p>").html("Not supported by your browser. You probably need to go Chrome Canary."));return}var c=this.thingy;var h=this;if(!d){this.c={t:"sine",f:0.1,d:0}}var g=function(e){h.c.t=e;switch(e){case"sine":c.type=c.SINE;break;case"square":c.type=c.SQUARE;break;case"sawtooth":c.type=c.SAWTOOTH;break;case"triangle":c.type=c.TRIANGLE;break}};var o=function(s,e){h.c.f=e.value;var t=30;var u=context.sampleRate/2;var r=Math.log(u/t)/Math.LN2;var w=Math.pow(2,r*(e.value-1));c.frequency.value=u*w;k.html("Frequency "+Math.floor(c.frequency.value)+" Hz")};var q=function(r,e){h.c.d=e.value;c.detune.value=e.value;p.html("Detune "+e.value+" Cents")};var a=$("<select>");a.append($("<option>").html("sine"));a.append($("<option>").html("square"));a.append($("<option>").html("sawtooth"));a.append($("<option>").html("triangle"));a.val(this.c.t);a.on("change",function(){g(this.value)});b.append($('<a href="#" rel="tooltip" title="The shape of the periodic waveform">').tooltip().html("Type"));b.append(a);b.append($("<br/>"));g(this.c.t);var f=$("<div>");var k=$('<a href="#" rel="tooltip" title="The frequency of the periodic waveform.">').tooltip();f.slider({min:0,max:1,step:0.01,value:this.c.f,slide:o});b.append(k);b.append(f);b.append($("<br/>"));o(null,{value:this.c.f});var j=$("<div>");var p=$('<a href="#" rel="tooltip" title="A detuning value which will offset the frequency by the given amount">').tooltip();j.slider({min:-100,max:100,step:1,value:this.c.d,slide:q});b.append(p);b.append(j);q(null,{value:this.c.d});c.noteOn(0)},shutdown:function(){this.thingy.noteOff(0)}});var MicrophoneNode=BaseNode.extend({init:function(c){this._super(c);this.shortName="mn";this.name="Microphone";this.icon=" icon-user";this.tooltip="Gets audio input from a microphone";var d=this;this.myLazyConnections=new Array();var f=this.createMainEl(true,false,true,128);var b=$("<p>");f.append(b);try{var a=function(n){d.thingy=context.createMediaStreamSource(n);for(var k in d.myLazyConnections){d.connectTo(d.myLazyConnections[k])}for(var e in d.myConnections){var m=d.myConnections[e];d.createConnectionLine(d.el,m.el,d.idx,m.idx,false)}d.updateConnectionLines();d.myLazyConnections=new Array();b.html("Recording...")};var g=function(j){b.html("Failed to start recording");console.log(j)};if(navigator.getUserMedia){navigator.getUserMedia({audio:true,video:false},a,g)}else{if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia({audio:true,video:false},a,g)}else{b.html("Not yet supported in your browser. Try Chrome Canary with Web Audio Input flag set.")}}}catch(h){b.html("Not yet supported in your browser. Try Chrome Canary with Web Audio Input flag set.")}},lazyConnectTo:function(a){this.myLazyConnections.push(a)}});var AnalyzerNode=BaseNode.extend({init:function(h,d){this._super(h,d);this.shortName="an";this.thingy=context.createAnalyser();this.icon="icon-eye-open";this.name="Analyzer";this.tooltip="Provides real-time frequency and time-domain analysis information. The audio stream will be passed un-processed from input to output.";var c=this.createMainEl(true,true,true);c.css("margin",0);var g=this.thingy;var e=this;if(!d){this.c={vm:0}}var b=$('<a href="#" rel="tooltip" title="Click to change visualization">').tooltip({placement:"bottom"});c.append(b);var a=new SoundVisualizer(b,150,120);a.canvas.on("click",function(){e.c.vm++;if(e.c.vm==2){a.clear()}else{if(e.c.vm==3){e.c.vm=0;window.requestAnimationFrame(j)}}});var f=null;var j=function(){if(f==null){f=new Uint8Array(g.frequencyBinCount)}if(e.c.vm==0){g.getByteTimeDomainData(f);a.visualizeTimeDomainData(f);window.requestAnimationFrame(j)}else{if(e.c.vm==1){g.getByteFrequencyData(f);a.visualizeFrequencyData(f);window.requestAnimationFrame(j)}}};window.requestAnimationFrame(j)}});var TextToSpeechNode=BaseNode.extend({init:function(k,e){this._super(k,e);this.shortName="tts";this.thingy=context.createBufferSource();this.name="Text To Speech";this.icon="icon-font";this.tooltip="Uses the brilliant speak.js to speak the text";var h=this;if(!e){this.c={t:"All your bases are belong to us!",p:50,s:150,g:0}}var m=function(t,s){h.c.p=s.value;o.html("Pitch "+s.value)};var b=function(t,s){h.c.s=s.value;n.html("Speed "+s.value+" word / minute")};var d=function(t,s){h.c.g=s.value;a.html("Word Gap "+s.value+" ms")};var c=this.createMainEl(true,false,true,313,241);c.css("width","221px");var g=$("<div>");var o=$('<a href="#" rel="tooltip" title="The voice pitch">').tooltip();g.slider({min:10,max:100,value:this.c.p,step:1,slide:m});c.append(o);c.append(g);m(null,{value:this.c.p});var f=$("<div>");var n=$('<a href="#" rel="tooltip" title="The speed at which to talk">').tooltip();f.slider({min:10,max:300,value:this.c.s,step:1,slide:b});c.append(n);c.append(f);b(null,{value:this.c.s});var q=$("<div>");var a=$('<a href="#" rel="tooltip" title="Additional gap between words">').tooltip();q.slider({min:0,max:200,value:this.c.g,step:10,slide:d});c.append(a);c.append(q);d(null,{value:this.c.g});var p=$("<textarea>");var r=$("<input>");var j=function(t){h.c.t=t;h.loader.fadeIn("fast");r.attr("disabled","true");var s=new Worker("js/speakWorker.js");s.onmessage=function(u){h.thingy=context.createBufferSource();context.decodeAudioData(u.data.buffer,function(w){h.thingy.buffer=w;for(var y in h.myConnections){var z=h.myConnections[y];var x=z.getConnections();for(var y in x){h.thingy.connect(x[y])}}h.thingy.noteOn(0);setTimeout(function(){h.thingy.noteOff(0);for(var B in h.myConnections){var C=h.myConnections[B];var A=C.getConnections();for(var B in A){h.thingy.disconnect(A[B])}}r.removeAttr("disabled")},w.duration*1000);h.loader.fadeOut("fast")})};s.postMessage({text:t,args:{pitch:h.c.p,speed:h.c.s,wordgap:h.c.g/10}})};p.attr("cols","30");p.attr("rows","6");p.val(this.c.t);r.attr({type:"button",value:"Speak"});r.on("click",function(){j(p.val())});c.append($("<br/>"));c.append(p);c.append($("<br/>"));c.append(r)}});var PianoNode=BaseNode.extend({init:function(j,E){this._super(j,E);this.shortName="pn";this.name="Piano";this.icon=" icon-play";this.tooltip="Play piano on your keyboard. ";this.deleted=false;var c=this.createMainEl(true,false,true,290);try{this.thingy=context.createOscillator();if(typeof this.thingy.noteOn!="function"){throw new Exception()}}catch(A){c.append($("<p>").html("Not supported by your browser. You probably need to go Chrome Canary."));return}var q=this;if(!E){this.c={t:"sine",d:0,o:2,at:0.3,de:0.3,su:0.8,re:0.3}}var a=this.pianoNotes={};var o=this.shutupFnc=function(e){if(!e){return}e.gain.gain.linearRampToValueAtTime(0,context.currentTime+q.c.re);setTimeout(function(){e.osc.noteOff(0);e.osc.disconnect(e.gain);for(var I in q.myConnections){var J=q.myConnections[I];var H=J.getConnections();for(var I in H){e.gain.disconnect(H[I])}}},q.c.re*1000+50)};var r=function(){var I={};I.osc=context.createOscillator();I.gain=context.createGainNode();I.osc.connect(I.gain);for(var H in q.myConnections){var J=q.myConnections[H];var e=J.getConnections();for(var H in e){I.gain.connect(e[H])}}I.osc.noteOn(0);I.gain.gain.linearRampToValueAtTime(0,context.currentTime);I.gain.gain.linearRampToValueAtTime(1,context.currentTime+q.c.at);setTimeout(function(){if(I.gain.gain.value==1){I.gain.gain.linearRampToValueAtTime(q.c.su,context.currentTime+q.c.de)}},q.c.at*1000);return I};var g=function(e){q.c.t=e;var I=null;switch(e){case"sine":I=q.thingy.SINE;break;case"square":I=q.thingy.SQUARE;break;case"sawtooth":I=q.thingy.SAWTOOTH;break;case"triangle":I=q.thingy.TRIANGLE;break}if(I){for(var H in a){if(a[H]){a[H].osc.type=I}}}};var B=function(H,e){q.c.o=e.value;n.html("Octave "+e.value)};var u=function(I,e){q.c.d=e.value;for(var H in a){if(a[H]){a[H].osc.detune.value=e.value}}d.html("Detune "+e.value+" Cents")};var h=function(H,e){q.c.at=e.value;z.html("Attack "+e.value+" s")};var b=function(H,e){q.c.de=e.value;f.html("Decay "+e.value+" s")};var y=function(H,e){q.c.su=e.value;w.html("Sustain level "+e.value)};var p=function(H,e){q.c.re=e.value;x.html("Release "+e.value+" s")};var G={Z:65.406,S:69.296,X:73.416,D:77.782,C:82.407,V:87.307,G:92.499,B:97.999,H:103.826,N:110,J:116.541,M:123.471,Q:65.406*2,"2":69.296*2,W:73.416*2,"3":77.782*2,E:82.407*2,R:87.307*2,"5":92.499*2,T:97.999*2,"6":103.826*2,Y:110*2,"7":116.541*2,U:123.471*2};this.onkeydown=function(I){if(q.deleted){return}var H=String.fromCharCode(I.keyCode);if(!a[H]){if(G[H]){a[H]=r();a[H].osc.frequency.value=G[H]*q.c.o;g(q.c.t);u(null,{value:q.c.d})}}};this.onkeyup=function(I){if(q.deleted){return}var H=String.fromCharCode(I.keyCode);o(a[H]);a[H]=null};var t=$("<select>");t.append($("<option>").html("sine"));t.append($("<option>").html("square"));t.append($("<option>").html("sawtooth"));t.append($("<option>").html("triangle"));t.val(this.c.t);t.on("change",function(){g(this.value)});c.append($('<a href="#" rel="tooltip" title="The shape of the periodic waveform">').tooltip().html("Type"));c.append(t);c.append($("<br/>"));g(this.c.t);var s=$("<div>");var n=$('<a href="#" rel="tooltip" title="Select the octave of the piano">').tooltip();s.slider({min:1,max:6,step:1,value:this.c.o,slide:B});c.append(n);c.append(s);B(null,{value:this.c.o});var k=$("<div>");var d=$('<a href="#" rel="tooltip" title="A detuning value which will offset the frequency by the given amount">').tooltip();k.slider({min:-100,max:100,step:1,value:this.c.d,slide:u});c.append(d);c.append(k);u(null,{value:this.c.d});var F=$("<div>");var z=$('<a href="#" rel="tooltip" title="Attack time is the time taken for initial run-up of level from nil to peak">').tooltip();F.slider({min:0,max:1,step:0.01,value:this.c.at,slide:h});c.append(z);c.append(F);h(null,{value:this.c.at});var m=$("<div>");var f=$('<a href="#" rel="tooltip" title="Decay time is the time taken for the subsequent run down from the attack level to the designated sustain level.">').tooltip();m.slider({min:0,max:1,step:0.01,value:this.c.de,slide:b});c.append(f);c.append(m);b(null,{value:this.c.de});var C=$("<div>");var w=$('<a href="#" rel="tooltip" title="Sustain level is the level during the main sequence of the sound\'s duration, until the key is released.">').tooltip();C.slider({min:0,max:1,step:0.01,value:this.c.su,slide:y});c.append(w);c.append(C);y(null,{value:this.c.su});var D=$("<div>");var x=$('<a href="#" rel="tooltip" title="Release time is the time taken for the level to decay from the sustain level to zero after the key is released.">').tooltip();D.slider({min:0,max:1,step:0.01,value:this.c.re,slide:p});c.append(x);c.append(D);p(null,{value:this.c.re});if(!localStorage.shownPianoInfo){localStorage.shownPianoInfo="yes";$("#pianoInfoBox").modal()}},shutdown:function(){for(var a in this.pianoNotes){this.shutupFnc(this.pianoNotes[a])}this.deleted=true}});var NoiseNode=BaseNode.extend({init:function(d,c){this._super(d,c);this.shortName="nn";this.thingy=context.createJavaScriptNode(4096,1,1);this.name="Noise";this.icon="icon-question-sign";this.tooltip="Amplifies each sample in the signal with random amount";var g=this.createMainEl(true,true,true,78);var e=this;if(!c){this.c={v:0.5}}var f=function(j,h){e.c.v=h.value;b.html("Amount "+h.value)};var a=$("<div>");var b=$('<a href="#" rel="tooltip" title="Set noise amount">').tooltip();a.slider({min:0,max:3,value:this.c.v,step:0.01,slide:f});g.append(b);g.append(a);f(null,{value:this.c.v});this.thingy.onaudioprocess=function(m){var k=m.inputBuffer.getChannelData(0);var h=m.outputBuffer.getChannelData(0);for(var j=0;j<k.length;j++){h[j]=k[j]*(1+(Math.random()*e.c.v)-e.c.v*0.5)}}}});var VibratoNode=BaseNode.extend({init:function(h,c){this._super(h,c);this.shortName="vn";this.thingy=context.createJavaScriptNode(4096,1,1);this.name="Vibrato";this.icon="icon-leaf";this.tooltip="Adds a vibrato effect to the signal";var b=this.createMainEl(true,true,true,110);var g=this;if(!c){this.c={v:0.5,s:1}}var k=function(o,n){g.c.v=n.value;e.html("Amount "+n.value)};var a=function(o,n){g.c.s=n.value;j.html("Speed "+n.value)};var m=$("<div>");var e=$('<a href="#" rel="tooltip" title="Set vibrato amount">').tooltip();m.slider({min:0,max:3,value:this.c.v,step:0.01,slide:k});b.append(e);b.append(m);k(null,{value:this.c.v});var f=$("<div>");var j=$('<a href="#" rel="tooltip" title="Set vibrato speed">').tooltip();f.slider({min:0,max:3,value:this.c.v,step:0.01,slide:a});b.append(j);b.append(f);a(null,{value:this.c.s});var d=0;this.thingy.onaudioprocess=function(q){var p=q.inputBuffer.getChannelData(0);var n=q.outputBuffer.getChannelData(0);for(var o=0;o<p.length;o++){n[o]=p[o]*(1+Math.sin(d*g.c.s*0.001)*g.c.v);d++}}}});var PitchNode=BaseNode.extend({init:function(d,c){this._super(d,c);this.shortName="ptn";this.thingy=context.createJavaScriptNode(8192,1,1);this.name="Pitch";this.icon="icon-resize-full";this.tooltip="A simple artifact introducing pitch changer";var g=this.createMainEl(true,true,true,78);var e=this;if(!c){this.c={v:1}}var f=function(j,h){e.c.v=h.value;b.html("Amount "+h.value)};var a=$("<div>");var b=$('<a href="#" rel="tooltip" title="Set pitch amount">').tooltip();a.slider({min:0,max:3,value:this.c.v,step:0.01,slide:f});g.append(b);g.append(a);f(null,{value:this.c.v});this.thingy.onaudioprocess=function(p){var o=p.inputBuffer.getChannelData(0);var k=p.outputBuffer.getChannelData(0);var j;var n;var h=o.length;for(var m=0;m<h;m++){j=Math.floor(m*e.c.v);if(j>=h){j=h-(j-h)-1}n=o[j];k[m]=n}}}});var SaveHandler=Class.extend({init:function(){this.localStorageSavePrefix="save_"},createSaveData:function(){var d={nodes:[]};for(var c in nodes){var e=nodes[c];if(!e.deleted){var a=new Array();for(var b in e.myConnections){if(!e.myConnections[b].deleted){a.push(e.myConnections[b].idx)}}d.nodes.push({i:e.idx,sn:e.shortName,d:e.c,p:e.el.offset(),c:a})}}return window.btoa(JSON.stringify(d))},loadSaveData:function(f){var h=JSON.parse(window.atob(f));for(var g in nodes){for(var e in nodes[g].myConnections){nodes[g].disconnectFrom(nodes[g].myConnections[e])}nodes[g].shutdown();nodes[g].el.remove()}$(".line").remove();nodes=new Array();for(var g in h.nodes){var c=h.nodes[g];var d=this.createNodeFromString(c);d.el.offset(c.p);nodes[c.i]=d}for(var g in h.nodes){var c=h.nodes[g];if(c.c.length>0){for(var e in c.c){var m=c.c[e];var k=nodes[c.i];if(k instanceof MicrophoneNode){k.lazyConnectTo(nodes[m])}else{k.connectTo(nodes[m])}}}}for(var g in nodes){var b=nodes[g];if(b){for(var e in b.myConnections){var a=b.myConnections[e];b.createConnectionLine(b.el,a.el,b.idx,a.idx,false)}b.updateConnectionLines()}}},createNodeFromString:function(b){var a=null;switch(b.sn){case"mn":a=new MicrophoneNode(b.i,b.d);break;case"gn":a=new GainNode(b.i,b.d);break;case"scn":a=new ScriptNode(b.i,b.d);break;case"son":a=new SourceNode(b.i,b.d);break;case"bfn":a=new BiquadFilterNode(b.i,b.d);break;case"cn":a=new ConvolverNode(b.i,b.d);break;case"deln":a=new DelayNode(b.i,b.d);break;case"dstn":a=new DestinationNode(b.i,b.d);break;case"dcn":a=new DynamicsCompressorNode(b.i,b.d);break;case"wsn":a=new WaveShaperNode(b.i,b.d);break;case"on":a=new OscillatorNode(b.i,b.d);break;case"an":a=new AnalyzerNode(b.i,b.d);break;case"tts":a=new TextToSpeechNode(b.i,b.d);break;case"pn":a=new PianoNode(b.i,b.d);break;case"nn":a=new NoiseNode(b.i,b.d);break;case"vn":a=new VibratoNode(b.i,b.d);break;case"ptn":a=new PitchNode(b.i,b.d);break}return a},saveToLocalStorage:function(b){var a=this.createSaveData();localStorage[this.localStorageSavePrefix+b]=a},loadFromLocalStorage:function(b){var a=localStorage[this.localStorageSavePrefix+b];this.loadSaveData(a)},getAllSavesInLocalStorage:function(){var a=new Array();for(var c=0;c<localStorage.length;c++){var b=localStorage.key(c);if(b.substr(0,5)===this.localStorageSavePrefix){a.push(b.substr(5))}}return a}});(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());var nodes=new Array();var context=null;var connLineWidth=30;$(function(){var c=function(){var e=$("#loadSelect");var h=$("#loadNothing");var g=$("#loadOkBtn");e.empty();var d=new SaveHandler().getAllSavesInLocalStorage();for(var f in d){e.append($("<option>").html(d[f]))}if(d.length===0){e.hide();h.show();g.addClass("disabled")}else{e.show();h.hide();g.removeClass("disabled")}};$("body").css("height",window.innerHeight-40);$("a.brand").tooltip({placement:"bottom"});$("#firstTimeChk").on("change",function(){if(this.checked){localStorage.beenherebefore="yes"}else{localStorage.removeItem("beenherebefore")}});$("#pianoInfoChk").on("change",function(){if(this.checked){localStorage.shownPianoInfo="yes"}else{localStorage.removeItem("shownPianoInfo")}});var a=function(e){var d=new SaveHandler();var f=d.createNodeFromString({sn:e,i:nodes.length});nodes.push(f);return f};$("ul.nodeslist > li > a").draggable({revert:true});$("body").droppable({accept:"ul.nodeslist > li > a",drop:function(e,f){var d=$(f.draggable[0]).attr("data-nodetype");var g=a(d);g.el.offset({left:e.clientX,top:e.clientY})}});$("ul.nodeslist > li > a").on("click",function(){var d=$(this).attr("data-nodetype");a(d)});try{context=new (window.AudioContext||window.webkitAudioContext)()}catch(b){context=null}document.onkeydown=function(f){for(var d in nodes){if(nodes[d]&&nodes[d] instanceof PianoNode){nodes[d].onkeydown(f)}}};document.onkeyup=function(f){for(var d in nodes){if(nodes[d]&&nodes[d] instanceof PianoNode){nodes[d].onkeyup(f)}}};if(context==null){$("#noWebAudioBox").modal()}else{setTimeout(function(){var d=getUrlParams();if(d.data){new SaveHandler().loadSaveData(d.data)}else{nodes[0]=new SourceNode(0);nodes[1]=new DestinationNode(1);nodes[0].el.offset({left:250,top:window.innerHeight/2-100});nodes[1].el.offset({left:window.innerWidth-200,top:window.innerHeight/2-150})}if(!localStorage.beenherebefore&&!d.data){localStorage.beenherebefore="yes";$("#firstTimeBox").modal()}},700);$("#saveOkBtn").on("click",function(){var d=$("#saveTxt").val();if(d.length>0){new SaveHandler().saveToLocalStorage(d);c();$("#saveBox").modal("hide")}});$("#saveTxt").on("keyup",function(){if($(this).val().length==0){$("#saveOkBtn").addClass("disabled")}else{$("#saveOkBtn").removeClass("disabled")}});$("#loadOkBtn").on("click",function(){var d=$("#loadSelect").val();new SaveHandler().loadFromLocalStorage(d);$("#saveTxt").val(d);$("#saveOkBtn").removeClass("disabled");$("#loadBox").modal("hide")});$("#shareBtn").on("click",function(){var d=window.location.origin+window.location.pathname+"?data="+new SaveHandler().createSaveData();$("#shareLink").attr("href",d).html(d);$("#shareBox").modal()});c();$(document.body).on("keypress","select",function(d){d.preventDefault()})}});function getUrlParams(){var a={};window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(d,b,c){a[b]=c});return a};